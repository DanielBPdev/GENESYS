<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>com.asopagos.coreaas.database</groupId>
		<artifactId>database-resources</artifactId>
		<version>0.0.2-SNAPSHOT</version>
	</parent>

	<artifactId>database-pila</artifactId>
	<name>Databasess pila artifacts</name>
	<description>Contains artifacts to generate data structures and store procedure to pila database</description>

	<properties>
		<databaseHost>${dbserver.pruebas}</databaseHost>
		<databasePort>1433</databasePort>
		<liquibase.url>jdbc:sqlserver://${databaseHost}:${databasePort};databaseName=${databaseName};integratedSecurity=false;</liquibase.url>
		<liquibase.changeLogFile>${project.build.resources[0].directory}/master.xml</liquibase.changeLogFile>
		<sshUser>admin</sshUser>
		<sshPass>juagonzalez</sshPass>
		<usuarioConPila>${databaseName}_aplicacion</usuarioConPila>
		<usuarioConCore>${databaseNameCore}_aplicacion</usuarioConCore>
		<SSIS.home>C:\SSIS_Packages\PILA2\${usuarioConPila}</SSIS.home>
		<SSIS.folder>SSIS_Packages/PILA2/${usuarioConPila}</SSIS.folder>
		<propertyCore>Data Source=${databaseHost};User
			ID=${usuarioConCore};Initial
			Catalog=${usuarioConCore};Password=${databaseCorePassword};Provider=SQLNCLI11.1;Persist
			Security Info=True;Auto Translate=False;</propertyCore>
		<propertyPila>Data Source=${databaseHost};User
			ID=${usuarioConPila};Initial
			Catalog=${usuarioConPila};Password=${databasePilaPassword};Provider=SQLNCLI11.1;Persist
			Security Info=True;Auto Translate=False;</propertyPila>
		<skip.ant>false</skip.ant>
	</properties>

	<build>
		<plugins>
			<plugin>
				<groupId>org.liquibase</groupId>
				<artifactId>liquibase-maven-plugin</artifactId>
				<configuration>
					<skip>false</skip>
					<changeLogFile>${project.build.resources[0].directory}/master.xml</changeLogFile>
					<promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
				</configuration>
			</plugin>
	 			<plugin>
	 				<artifactId>maven-antrun-plugin</artifactId>
	 				<executions>
	 					<execution>
	 						<id>replacePila</id>
	 						<phase>process-resources</phase>
	 						<goals>
	 							<goal>run</goal>
	 						</goals>
	 						<configuration>
	 							<target>
	 								<copy file="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx"
	 									tofile="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx"
	 									overwrite="true" />
	 								<replace
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx">
	 									<replacetoken>@host</replacetoken>
	 									<replacevalue>${databaseHost}</replacevalue>
	 								</replace>
	 								<replace
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx">
	 									<replacetoken>ID=@databasepila</replacetoken>
	 									<replacevalue>ID=${usuarioConPila}</replacevalue>
	 								</replace>
	 								<replace
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx">
	 									<replacetoken>ID=@databasecore</replacetoken>
	 									<replacevalue>ID=${usuarioConCore}</replacevalue>
	 								</replace>
	 								<replace
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx">
	 									<replacetoken>Catalog=@databasepila</replacetoken>
	 									<replacevalue>Catalog=${databaseName};Password=${databasePilaPassword}</replacevalue>
	 								</replace>
	 								<replace
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx">
	 									<replacetoken>Catalog=@databasecore</replacetoken>
	 									<replacevalue>Catalog=${databaseNameCore};Password=${databaseCorePassword}</replacevalue>
	 								</replace>
	 							</target>
	 						</configuration>
	 					</execution>
	 					<execution>
	 						<id>copySSIS</id>
	 						<phase>none</phase>
	 						<goals>
	 							<goal>run</goal>
	 						</goals>
	 						<configuration>
	 							<target>
	 								<sshexec trust="true" failonerror="false" host="${databaseHost}"
	 									username="${sshUser}" password="${sshPass}" command="cmd /c mkdir ${SSIS.home}"
	 									timeout="120000" />
	 								<taskdef name="scp"
	 									classname="org.apache.tools.ant.taskdefs.optional.ssh.Scp">
	 									<classpath refid="maven.plugin.classpath" />
	 								</taskdef>
	 								<scp
	 									file="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx"
	 									todir="${sshUser}:${sshPass}@${databaseHost}:${SSIS.folder}"
	 									trust="true" />
	 							</target>
	 						</configuration>
	 					</execution>
	 				</executions>
	 				<dependencies>
	 					<dependency>
	 						<groupId>ant</groupId>
	 						<artifactId>ant-commons-net</artifactId>
	 						<version>${ant.commons.net}</version>
	 					</dependency>
	 					<dependency>
	 						<groupId>org.apache.ant</groupId>
	 						<artifactId>ant-jsch</artifactId>
	 						<version>${ant.jsch}</version>
	 					</dependency>
	 				</dependencies>
	 			</plugin>
		</plugins>
	</build>

	<profiles>
		<profile>
			<id>developer</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<databaseName>pila_${user.name}</databaseName>
				<databaseNameCore>core_${user.name}</databaseNameCore>
				<databasePilaPassword>${user.name}</databasePilaPassword>
				<databaseCorePassword>${user.name}</databaseCorePassword>
				<liquibase.username>pila_${user.name}</liquibase.username>
				<liquibase.password>${user.name}</liquibase.password>
				<liquibase.contexts>integracion</liquibase.contexts>
				<usuarioConPila>${databaseName}</usuarioConPila>
				<usuarioConCore>${databaseNameCore}</usuarioConCore>
			</properties>
		</profile>
		<profile>
			<id>integracion</id>
			<properties>
				<databaseHost>${dbserver.integracion}</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>				
				<liquibase.password>${settings.servers.dbIntegracion.password}</liquibase.password>
				<liquibase.contexts>integracion</liquibase.contexts>
			</properties>
		</profile>
		<profile>
			<id>pruebas</id>
			<properties>
				<databaseHost>${dbserver.pruebas}</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>				
				<liquibase.password>${settings.servers.dbPruebas.password}</liquibase.password>
				<liquibase.contexts>pruebas</liquibase.contexts>
			</properties>
		</profile>
		<profile>
			<id>pruebas-asopagos</id>
			<properties>
				<databaseHost>${dbserver.pruebas-asopagos}</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>				
				<liquibase.password>${settings.servers.dbPruebasAsopagos.password}</liquibase.password>
				<liquibase.contexts>pruebas-asopagos</liquibase.contexts>
				<skip.ant>true</skip.ant>
			</properties>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						
							<executions>
								<execution>
									<id>replacePila</id>
									<configuration>
										<skip>${skip.ant}</skip>
									</configuration>
								</execution>
								<execution>
									<id>copySSIS</id>
									<configuration>
										<skip>${skip.ant}</skip>
									</configuration>
								</execution>
							</executions>
					</plugin>

				</plugins>
			</build>
		</profile>
		<profile>
			<id>subsidio</id>
			<properties>
				<databaseHost>${dbserver.subsidio}</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>
				<liquibase.password>${settings.servers.dbIntegracion.password}</liquibase.password>
				<liquibase.contexts>asopagosSubsidio</liquibase.contexts>
			</properties>
		</profile>
		<profile>
			<id>cloud-integracion</id>
			<properties>
				<databaseHost>${dbserver.cloud-integracion}</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>
				<liquibase.username>sqladmin</liquibase.username>
				<liquibase.password>Zaqwsx1234$</liquibase.password>
				<liquibase.contexts>cloud-integracion</liquibase.contexts>
			</properties>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
							<executions>
								<execution>
									<id>replacePila</id>
									<phase>none</phase>
								</execution>
								<execution>
									<id>copySSIS</id>
									<phase>none</phase>
								</execution>
							</executions>
					</plugin>

				</plugins>
			</build>
		</profile>
		<profile>
			<id>cloud-reportes</id>
			<properties>
				<databaseHost>asopagossubsidioshbt01.database.windows.net</databaseHost>
				<databaseName>pila</databaseName>
				<databaseNameCore>core</databaseNameCore>
				<liquibase.username>sqladmin</liquibase.username>
				<liquibase.password>Zaqwsx1234$</liquibase.password>
				<liquibase.contexts>cloud-reportes</liquibase.contexts>
			</properties>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
							<executions>
								<execution>
									<id>replacePila</id>
									<phase>none</phase>
								</execution>
								<execution>
									<id>copySSIS</id>
									<phase>none</phase>
								</execution>
							</executions>
					</plugin>

				</plugins>
			</build>
		</profile>
		<profile>
			<id>pila</id>
			<properties>
				<databaseName>pila_${user.name}</databaseName>
				<databaseNameCore>core_${user.name}</databaseNameCore>
				<databasePilaPassword>${user.name}</databasePilaPassword>
				<databaseCorePassword>${user.name}</databaseCorePassword>
				<liquibase.username>pila_${user.name}</liquibase.username>
				<liquibase.password>${user.name}</liquibase.password>
				<liquibase.contexts>integracion</liquibase.contexts>
				<usuarioConPila>${databaseName}</usuarioConPila>
				<usuarioConCore>${databaseNameCore}</usuarioConCore>
			</properties>

			<build>
				<plugins>
					<plugin>
						<artifactId>maven-antrun-plugin</artifactId>
						<executions>
							<execution>
								<id>replacePila</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>run</goal>
								</goals>
								<configuration>
									<target>
										<copy
											file="${basedir}/src/main/resources/SSIS/GENESYS_PILA2_SSIS2/ExecuteBloqueStaging.dtsx"
											tofile="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx"
											overwrite="true" />
										<replace
											file="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx">
											<replacetoken>core_${user.name}</replacetoken>
											<replacevalue>@databasecore</replacevalue>
										</replace>
										<replace
											file="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx">
											<replacetoken>${dbserver.integracion}</replacetoken>
											<replacevalue>@host</replacevalue>
										</replace>
										<replace
											file="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx">
											<replacetoken>pila_${user.name}</replacetoken>
											<replacevalue>@databasepila</replacevalue>
										</replace>
										<copy file="${basedir}/src/main/archivos/ExecuteBloqueStaging.dtsx"
											tofile="${project.build.directory}/classes/ExecuteBloqueStaging.dtsx"
											overwrite="true" />
									</target>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

</project>
