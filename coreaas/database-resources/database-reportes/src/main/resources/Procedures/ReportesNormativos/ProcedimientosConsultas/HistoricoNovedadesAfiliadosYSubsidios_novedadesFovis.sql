DECLARE @DBNAME VARCHAR(255),
		@sql NVARCHAR(4000),
		@fechaInicio DATE = '20190601',
		@fechaFin DATE = '20190901'

/*
 DROP TABLE #FechasNovedadesSolicituNovedad
 DROP TABLE #FechasNovedadesSolicituNovedadFovis
 DROP TABLE #PersonasModificacionDatosBasicos

 */

CREATE TABLE #PersonasModificacionDatosBasicos(perId BIGINT, actualNumeroId VARCHAR(16) , actualTipoId VARCHAR(20), anteriorNumeroId VARCHAR(16), anteriorTipoId VARCHAR(20), sl VARCHAR(500) )
CREATE TABLE #FechasNovedadesSolicituNovedad(snoId BIGINT, fechaRegistroNovedadCerrada DATE, sl VARCHAR(500))
CREATE TABLE #FechasNovedadesSolicituNovedadFovis(snfId BIGINT, fechaRegistroNovedadCerrada DATE, sl VARCHAR(500))

SET @sql = '
 SELECT DISTINCT perA.perid, perA.perNumeroIdentificacion actualNumeroId, perA.perTipoIdentificacion actualTipoId,
 	    aux.perNumeroIdentificacion anteriorNumeroId, aux.perTipoIdentificacion anterioTipoId 
 FROM Persona_aud perA
 INNER JOIN ( 
	 SELECT per.perId,per.REV,per.perNumeroIdentificacion, per.perTipoIdentificacion
	 FROM Persona_aud per 
	 inner JOIN Persona_aud perAux ON perAux.perId = per.perId AND perAux.perNumeroIdentificacion <> per.perNumeroIdentificacion
	 GROUP BY per.perNumeroIdentificacion, per.perTipoIdentificacion,per.REV,per.perId 
 ) aux ON aux.perId = perA.perId AND aux.perNumeroIdentificacion <> perA.pernumeroidentificacion AND aux.Rev < perA.REV
 UNION
 SELECT DISTINCT perB.perid, perB.perNumeroIdentificacion actualNumeroId, perB.perTipoIdentificacion actualTipoId,
 	    tablaAux.perNumeroIdentificacion anteriorNumeroId, tablaAux.perTipoIdentificacion anterioTipoId  
 FROM Persona_aud perB
 INNER JOIN(
 	 SELECT  per.perId, per.REV, per.perNumeroIdentificacion, per.perTipoIdentificacion
	 FROM Persona_aud per 
	 INNER JOIN dbo.Persona_aud perAux ON perAux.perId = per.perId AND perAux.perTipoIdentificacion <> per.perTipoIdentificacion
	 GROUP BY per.perNumeroIdentificacion, per.perTipoIdentificacion,per.REV,per.perId 
 ) tablaAux ON tablaAux.perId = perB.perId AND tablaAux.perTipoIdentificacion <> perB.perTipoIdentificacion  AND tablaAux.Rev < perB.REV '
 

INSERT INTO #PersonasModificacionDatosBasicos (perId , actualNumeroId, actualTipoId, anteriorNumeroId, anteriorTipoId, sl)
EXEC sp_execute_remote CoreAudReferenceData, @sql	

SET @sql = '
	SELECT sno.snfId, CAST(CONVERT(VARCHAR(10), dateadd(second, revTimeStamp / 1000, ''19700101'') AT TIME ZONE ''UTC'' AT TIME ZONE ''SA Pacific Standard Time'' ) AS DATE) AS fechaRegistroNovedadCerrada
FROM SolicitudNovedadFovis_aud sno 
INNER JOIN Revision rev ON (sno.REV = rev.revId)
INNER JOIN(
	SELECT sno1.snfId, sno1.REV  
	FROM SolicitudNovedadFovis_aud sno1 
	WHERE sno1.snfEstadoSolicitud = ''NOV_FOVIS_APROBADA''
	GROUP BY sno1.snfId,sno1.REV 
) aux ON aux.snfId = sno.snfId AND aux.REV < sno.REV
WHERE sno.snfEstadoSolicitud = ''NOV_FOVIS_CERRADA''
GROUP BY sno.snfId, revTimeStamp'

INSERT INTO #FechasNovedadesSolicituNovedadFovis(snfId, fechaRegistroNovedadCerrada, sl)
EXEC sp_execute_remote CoreAudReferenceData, @sql

SET @sql = '
SELECT sno.snoId, CAST(CONVERT(VARCHAR(10), dateadd(second, revTimeStamp / 1000, ''19700101'') AT TIME ZONE ''UTC'' AT TIME ZONE ''SA Pacific Standard Time'' ) AS DATE) AS fechaRegistroNovedadCerrada
FROM SolicitudNovedad_aud sno 
INNER JOIN Revision rev ON (sno.REV = rev.revId)
INNER JOIN(
	SELECT sno1.snoId, sno1.REV  
	FROM  SolicitudNovedad_aud sno1 
	WHERE sno1.snoEstadoSolicitud = ''APROBADA''
	GROUP BY sno1.snoId,sno1.REV 
) aux ON aux.snoId = sno.snoId AND aux.REV < sno.REV
WHERE sno.snoEstadoSolicitud = ''CERRADA''
GROUP BY sno.snoId, revTimeStamp'

INSERT INTO #FechasNovedadesSolicituNovedad(snoId, fechaRegistroNovedadCerrada, sl)
EXEC sp_execute_remote CoreAudReferenceData, @sql	

SELECT
			2 AS tipoRegistro,
			(SELECT cnsValor FROM dbo.Constante WHERE cnsNombre = 'CAJA_COMPENSACION_CODIGO') AS codigoCCF,
			CASE perJefeHogarAfiFovis.perTipoIdentificacion 
			    WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN 'PASAPORTE' THEN 'PA'
			    WHEN 'CARNE_DIPLOMATICO' THEN 'CD' 
			END AS tipoIdAfiliado,
			perJefeHogarAfiFovis.perNumeroIdentificacion AS numeroIdAfiliado,		
			SUBSTRING(perJefeHogarAfiFovis.perPrimerApellido,0,60) AS primerApellidoAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perSegundoApellido,0,60) AS segundoApellidoAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perPrimerNombre,0,60) AS primerNombreAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perSegundoNombre,0,60) AS segundoNombreAfiliado,
			CASE
				     WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB', 'CAMBIO_NOMBRE_APELLIDOS_PERSONAS',
           			'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB', 'CAMBIO_GENERO_PERSONAS')
				     THEN 'C01'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' THEN 'C02'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO',
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
					THEN 'C03' 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE') 
					THEN 'C04'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) 
					 THEN 'C08'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL 
			    	THEN 'C09' --si tiene registro en la tabla SolicituNovedadFovis es porque se realizo algÃºn cambio en el subsidio
			END AS codigoNovedad,
			--==== INICIA NOVEDAD C02 =====
			CASE  
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD' 
			    ELSE NULL
			END AS tipoIdAfiliado2, -- VARIABLE 1
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' -- CODIGO NOVEDAD C02
				THEN perJefeHogarAfiFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdAfiliado2, -- VARIABLE 2
			--========= FIN NOVEDAD C02 ========
			--========= INICIA NOVEDAD C01 =====
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01 
					 AND perDetJefeHogarAfiFovis.pedGenero = 'FEMENINO' THEN 'F'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetJefeHogarAfiFovis.pedGenero = 'MASCULINO' THEN 'M'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetJefeHogarAfiFovis.pedGenero ='INDEFINIDO' THEN 'I'
				ELSE NULL
			END AS codigoGeneroAfiliado2, -- VARIABLE 3
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perDetJefeHogarAfiFovis.pedFechaNacimiento 
				ELSE NULL
			END AS fechaNacimientoAfiliado2, -- VARIABLE 4
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN SUBSTRING(perJefeHogarAfiFovis.perPrimerApellido,0,60) 
				ELSE NULL
			END AS primerApellidoAfiliado2, -- VARIABLE 5
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perJefeHogarAfiFovis.perSegundoApellido 
				ELSE NULL
			END AS segundoApellidoAfiliado2, -- VARIABLE 6
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perJefeHogarAfiFovis.perPrimerNombre 
				ELSE NULL
			END AS primerNombreAfiliado2, -- VARIABLE 7
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perJefeHogarAfiFovis.perSegundoNombre 
				ELSE NULL
			END AS segundoNombreAfiliado2, -- VARIABLE 8
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN depAfiFovis.depCodigo
				ELSE NULL
			END AS departamentoAfiliado, -- VARIABLE 9
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN munAfiFovis.munCodigo 
				ELSE NULL
			END AS municipioAfiliado, -- VARIABLE 10
			--========= FIN NOVEDAD C01 ================
			--====== INICIA NOVEDAD C03 Y C07 ============
			CASE
				WHEN tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL
				THEN rolAfiFovis.roaFechaIngreso
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --CODIGO NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO') THEN empleadorAportanteFovis.empFechaCambioEstadoAfiliacion
			    WHEN  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION', -- CODIGO C03
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO') THEN rolAfiFovis.roaFechaIngreso 
				ELSE NULL
			END AS fechaAfiliacion, -- VARIABLE 11
			NULL AS VARABLE12,
			--====== FIN NOVEDAD C07 ============
			---===== INICIA NOVEDAD C03 ========
			CASE 
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					  AND rolAfiFovis.roaTipoAfiliado = 'TRABAJADOR_DEPENDIENTE' THEN 1
				WHEN ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					AND	 rolAfiFovis.roaTipoAfiliado = 'TRABAJADOR_INDEPENDIENTE' THEN 2 --2 - Trabajador afiliado facultativo
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')) 
					 AND rolAfiFovis.roaTipoAfiliado = 'PENSIONADO' THEN 3
				ELSE NULL
			END AS codigoTipoAfiliado, -- VARIABLE 13
			---===== INICIA NOVEDAD C04, CONTINUA C03 ========
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')) 
					 AND  perAportanteAfi.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='TARJETA_IDENTIDAD' THEN 'TI'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='CEDULA_EXTRANJERIA' THEN 'CE'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='PASAPORTE' THEN 'PA'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='CARNE_DIPLOMATICO' THEN 'CD' 
				ELSE NULL
			END AS tipoIdAportante,  -- VARIABLE 14
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perAportanteAfi.perNumeroIdentificacion 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perEmpAportanteAfi.perNumeroIdentificacion 
				ELSE NULL
			END AS numeroIdAportante, -- VARIABLE 15
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perEmpAportanteAfi.perDigitoVerificacion
				ELSE NULL
			END AS digitoVerificacionAportante, -- VARIABLE 16
			--======== FIN NOVEDAD C04 =========
			--==================================
			CASE 
				WHEN (aporteGenAfiFovis.apgPersona IS NOT NULL AND  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
				THEN CONCAT(perAportanteAfi.perPrimerNombre,' ',perAportanteAfi.perSegundoNombre, ' ', perAportanteAfi.perPrimerApellido, ' ',perAportanteAfi.perSegundoApellido)
				WHEN (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
				THEN perEmpAportanteAfi.perRazonSocial
				ELSE NULL
			END AS razonSocialAportante, -- VARIABLE 17
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN aporteGenAfiFovis.roaFechaAfiliacion 
				ELSE NULL
			END AS fechaVinculacionAportante, -- VARIABLE 18
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN depEmpAportanteAfi.depCodigo 
				ELSE NULL
			END AS departamentoUbicacion, -- VARIABLE 19
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN munEmpAportanteAfi.munCodigo 
				ELSE NULL
			END AS municipioUbicacion, -- VARIABLE 20
			NULL AS VARIABLE21,
			NULL AS VARIABLE22,
			--========================= FIN NOVEDAD C03 ==================
			--============================================================
			--ESTADO AFILIACIÃN 21: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--AL DIA (1- AL DIA O 2- EN MORA) 22: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--- ================= INICIO NOVEDAD 'C07' ================-----
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
			     	 AND tablaNuevoAfiBen.idBenAAfi IS NOT NULL THEN 1
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO') 
			     	 AND tablaNuevoAfiBen.idAfiABen IS NOT NULL  THEN 2
				ELSE NULL
			END AS codigoTipoMiembroPoblacionCubierta, -- VARIABLE 23
			---==== FIN ULTIMO CAMPO NOVEDAD C03 ============
			--- === NOVEDADES 'C07' Y 'C08' =================
			CASE
				WHEN tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )  AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN perJefeHogarAfiFovis.perTipoIdentificacion
				WHEN (tablaNuevoAfiBen.idAfiABen IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL)
				THEN perBenFovis.perTipoIdentificacion
				END AS tipoIdMiembroPoblacionCubierta, -- VARIABLE 24
			CASE
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN perJefeHogarAfiFovis.perNumeroIdentificacion
				WHEN (tablaNuevoAfiBen.idAfiABen IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL)
				THEN perBenFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdMiembroPoblacionCubierta, -- VARIABLE 25
			--- ==== FIN NOVEDAD 'C08' ========
			CASE 
				WHEN benFovis.benGradoAcademico IS NOT NULL AND benDetFovis.bedCertificadoEscolaridad = 1 THEN 'E' --ESTUDIANTE
				WHEN benFovis.benGradoAcademico IS NULL AND benDetFovis.bedCertificadoEscolaridad = 0 THEN 'D' --DISCAPACITADO
				ELSE NULL
			END AS codigoCondicionBeneficiario, -- VARIABLE 26
			CASE
				WHEN --codigoNovedad = 'C07' 
					(tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario = 'CONYUGE' THEN 1
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('HIJO_BIOLOGICO','HIJO_ADOPTIVO','HIJASTRO','BENEFICIARIO_EN_CUSTODIA') THEN 2
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('PADRE','MADRE') THEN 3
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('HERMANO_HUERFANO_DE_PADRES','HERMANO_HOGAR') THEN 4
				ELSE NULL
			END AS codigoTipoRelacionConAfiliadoBen, -- VARIABLE 27
			--- ================= FIN NOVEDAD 'C07' =====================-----
			--- ================= INICIO NOVEDAD 'C09' ====================----
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN dbo.SolicitudAsignacion.safFechaAceptacion 
				ELSE NULL
			END AS fechaAsignacionSubsidio, -- VARIABLE 28
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN LEFT(CAST(dbo.SolicitudAsignacion.safValorSFVAsignado AS VARCHAR), CHARINDEX('.', CAST(dbo.SolicitudAsignacion.safValorSFVAsignado AS VARCHAR)) - 1)
				ELSE NULL
			END AS valorSubsidio, -- VALOR 29
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN 4 
				ELSE NULL
			END AS codigoTipoSubsidio, -- VARIABLE 30
			CASE 
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('ASIGNADO_SIN_PRORROGA','ASIGNADO_CON_PRIMERA_PRORROGA',  --codigoNovedad = 'C09' 
					 'ASIGNADO_CON_SEGUNDA_PRORROGA', 'SUBSIDIO_LEGALIZADO') THEN 1
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('VENCIMIENTO_POR_ASIGNACION_SIN_PRORROGA',
					 'VENCIMIENTO_POR_ASIGNACION_SIN_SEGUNDA_PRORROGA', 'PENDIENTE_APROBACION_PRORROGA') THEN 2
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('SUBSIDIO_CON_ANTICIPO_DESEMBOLSADO','SUBSIDIO_DESEMBOLSADO') THEN 3
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar = 'VENCIMIENTO_POR_ASIGNACION_CON_SEGUNDA_PRORROGA_CADUCADA' THEN 4
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar = 'RECHAZADO' THEN 5 -- TODO: FALTA SABER QUE ANTES ESTUVO ASIGNADO
			    ELSE NULL
			END AS estadoSubsidio, -- VARIABLE 31
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN (SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_DEPTO_ID') 
				ELSE NULL
			END AS departamentoSubsidio, -- VARIABLE 32
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN (SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_MUNI_ID') 
				ELSE NULL
			END AS municipioSubsidio, -- VARIABLE 33
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN Legalizacion.fechaTransferencia 
				ELSE NULL
			END AS fechaEntregaUltimoSubsidio, -- VARIABLE 34
			--- ================= FIN NOVEDAD 'C09' =====================
			--===================================================
			--================== INICIO NOVEDAD C04 ===========================
			CASE
				WHEN  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE') --codigoNovedad = 'C04'
				THEN aporteGenAfiFovis.roaFechaRetiro
				ELSE NULL
			END AS fechaDesvinculacionAportante, -- VARIABLE 35
			 ---== NOVEDADES C04 Y C08 ====---
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE')) --codigoNovedad = 'C04' 
					 OR ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS', --codigoNovedad = 'C08'
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )  AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN rolAfiFovis.roaFechaRetiro
				WHEN ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS', --codigoNovedad = 'C08'
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL) THEN benFovis.benFechaRetiro
				ELSE NULL
			END AS fechaRetiroAfiliado, -- VARIABLE 36
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					  AND perDetJefeHogarAfiFovis.pedFechaFallecido IS NOT NULL)
					 THEN perDetJefeHogarAfiFovis.pedFechaFallecido 
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					  AND  perDetBenFovis.pedFechaFallecido IS NOT NULL) THEN perDetBenFovis.pedFechaFallecido
				ELSE NULL
			END AS fechaFallecimiento, -- VARIABLE 37
			--============= FIN NOVEDAD C04  ===========
			--- ================= INICIO NOVEDAD 'C09' ====================----
			CASE  
				WHEN --codigoNovedad = 'C09'
					 dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'REGISTRO_CIVIL' THEN 'RC'
			    WHEN --codigoNovedad = 'C09' 
			    	 dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD'
			    ELSE NULL
			END AS tipoIdbeneficiario,-- VARIABLE 38
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL --codigoNovedad = 'C09' 
				THEN perBenFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdBeneficiario, -- VARIABLE 39
			NULL AS VARIABLE40,
			NULL AS VARIABLE41,
			NULL AS VARIABLE42,
			NULL AS VARIABLE43,
			NULL AS VARIABLE44,
			NULL AS VARIABLE45,
			NULL AS VARIABLE46,
			NULL AS VARIABLE47,
			NULL AS VARIABLE48,
			NULL AS VARIABLE49,
			NULL AS VARIABLE50,
			NULL AS VARIABLE51,
			NULL AS VARIABLE52,
			NULL AS VARIABLE53,
			NULL AS VARIABLE54,
			--- ================= FIN NOVEDAD 'C09' =====================
			/*CASE perDetBenFovis.pedGenero   --TODO: DEL CAMPO 40 AL 54 NO SE USAN
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroBeneficiario,
			perDetBenFovis.pedFechaExpedicionDocumento AS fechaNacimientoBeneficiario,
			perBenFovis.perPrimerApellido AS primerApellidoBeneficiario,
			perBenFovis.perSegundoApellido AS segundoApellidoBeneficiario,
			perBenFovis.perPrimerNombre  AS primerNombreBeneficiario,
			perBenFovis.perSegundoNombre AS segundoNombreBeneficiario,
			CASE perEmpAportanteAfi.perTipoIdentificacion--perEmpresaFovis.perTipoIdentificacion
			    WHEN 'CEDULA_CIUDADANIA' THEN 1
				WHEN 'NIT' THEN 2
			END AS tipoIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perNumeroIdentificacion
			perEmpAportanteAfi.perNumeroIdentificacion AS numeroIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perDigitoVerificacion 
			perEmpAportanteAfi.perDigitoVerificacion AS digitoVerificacionIdEmpresaSubsidio,
			--perEmpresaFovis.perRazonSocial 
			perEmpAportanteAfi.perRazonSocial AS razonSocialEmpresaSubsidio,
			1 AS aQuienSeOtorgoSubsidio, 
			':fechaInicio' AS fechaInicialPeriodoInformacion,
			':fechaFin' AS fechaFinalPeriodoInformacion,
			0 AS totalRegistroRelacionadosArchivo,
			':nombreReporte' AS nombreDelArchivo,*/ 
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL --codigoNovedad = 'C09' 
				THEN dbo.SolicitudAsignacion.safId 
				ELSE NULL
			END AS identificadorUnicoSubsidio, -- VARIABLE 55
			NULL AS nuevoTipoIdMiembrePoblacionCubierta,  --CAMPO 56
			NULL AS nuevoNumeroIdMiembroPoblacionCubierta, -- CAMPO57
			CASE
				WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ))
					 AND rolAfiFovis.roaFechaRetiro IS NOT NULL AND rolAfiFovis.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR') 
					 THEN 1
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					  AND ((rolAfiFovis.roaFechaRetiro IS NOT NULL AND rolAfiFovis.roaMotivoDesafiliacion = 'FALLECIMIENTO') OR
					 (benFovis.benFechaRetiro IS NOT NULL AND benFovis.benMotivoDesafiliacion = 'FALLECIMIENTO')) THEN 2
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					 AND (rolAfiFovis.roaMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' OR
					 empleadorAportanteFovis.empMotivoDesafiliacion = 'RETIRO_POR_TRASLADO_OTRA_CCF' OR benFovis.benMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' )
					 THEN 3
			    WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ))
			    	  AND dbo.ParametrizacionNovedad.novTipoTransaccion = 'SUSTITUCION_PATRONAL') THEN 6
			    WHEN ((dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) AND empleadorAportanteFovis.empMotivoDesafiliacion = 'FUSION_ADQUISICION' 
					  OR  dbo.ParametrizacionNovedad.novTipoTransaccion = 'DESAFILIAR_AUTOMATICAMENTE_EMPLEADORES_SOLICITUD_RECHAZADA'
					  AND rolAfiFovis.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR') THEN 7
			 	--TODO: FALTAN LAS CAUSAS DE RETIRO DE LA 4 A LA 12
				WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					 AND benFovis.benFechaRetiro IS NOT NULL AND benFovis.benMotivoDesafiliacion = 'OTROS' ) THEN 30 
				ELSE NULL
			END AS causaRetiro -- VARIABLE 58
			FROM dbo.SolicitudAsignacion
			INNER JOIN dbo.PostulacionFOVIS ON dbo.PostulacionFOVIS.pofSolicitudAsignacion = dbo.SolicitudAsignacion.safId
			INNER JOIN dbo.JefeHogar ON dbo.JefeHogar.jehId = dbo.PostulacionFOVIS.pofJefeHogar
			INNER JOIN dbo.Afiliado AS afiFovis ON afiFovis.afiId =dbo.JefeHogar.jehAfiliado
			INNER JOIN dbo.RolAfiliado AS rolAfiFovis ON rolAfiFovis.roaAfiliado = afiFovis.afiId
			INNER JOIN dbo.Persona AS perJefeHogarAfiFovis ON perJefeHogarAfiFovis.perId = afiFovis.afiPersona
			INNER JOIN dbo.Ubicacion AS ubiAfiFovis ON ubiAfiFovis.ubiId = perJefeHogarAfiFovis.perUbicacionPrincipal
			INNER JOIN dbo.Municipio AS munAfiFovis ON munAfiFovis.munId = ubiAfiFovis.ubiMunicipio
			INNER JOIN dbo.Departamento AS depAfiFovis ON depAfiFovis.depId = munAfiFovis.munDepartamento
			INNER JOIN dbo.PersonaDetalle AS perDetJefeHogarAfiFovis ON perDetJefeHogarAfiFovis.pedPersona = perJefeHogarAfiFovis.perId
			INNER JOIN dbo.AporteDetallado AS aporteDetAfiFovis ON aporteDetAfiFovis.apdPersona = afiFovis.afiPersona
			LEFT JOIN (
						SELECT CASE WHEN afiRol.roaEmpleador IS NOT NULL THEN NULL ELSE afi.afiPersona END apgPersona, 
								empleadorAporte.empEmpresa apgEmpresa,
							   	afiRol.roaFechaAfiliacion,
							   	afiRol.roaFechaRetiro,
							   	afiRol.roaId,
							   	empleadorAporte.empMotivoDesafiliacion,
							   	empleadorAporte.empFechaCambioEstadoAfiliacion
						FROM dbo.RolAfiliado AS afiRol
						LEFT JOIN dbo.Empleador AS empleadorAporte ON empleadorAporte.empId = afiRol.roaEmpleador
						LEFT JOIN dbo.Afiliado afi ON afi.afiId = afiRol.roaAfiliado
			) AS aporteGenAfiFovis ON aporteGenAfiFovis.roaId = rolAfiFovis.roaId
			LEFT JOIN dbo.Persona AS perAportanteAfi ON perAportanteAfi.perId = aporteGenAfiFovis.apgPersona
			LEFT JOIN dbo.Empresa AS empAportanteAfi ON empAportanteAfi.empId = aporteGenAfiFovis.apgEmpresa
			LEFT JOIN dbo.Empleador AS empleadorAportanteFovis ON empAportanteAfi.empId = empleadorAportanteFovis.empEmpresa
			LEFT JOIN dbo.Persona AS perEmpAportanteAfi ON perEmpAportanteAfi.perId = empAportanteAfi.empPersona
			LEFT JOIN dbo.Ubicacion AS ubiEmpAportanteAfi ON ubiEmpAportanteAfi.ubiId = perEmpAportanteAfi.perUbicacionPrincipal
			LEFT JOIN dbo.Municipio AS munEmpAportanteAfi ON munEmpAportanteAfi.munId = ubiEmpAportanteAfi.ubiMunicipio
			LEFT JOIN dbo.Departamento AS depEmpAportanteAfi ON depEmpAportanteAfi.depId = munEmpAportanteAfi.munDepartamento
			INNER JOIN dbo.Beneficiario AS benFovis ON benFovis.benAfiliado = afiFovis.afiId
			INNER JOIN dbo.BeneficiarioDetalle AS benDetFovis ON benDetFovis.bedId = benFovis.benBeneficiarioDetalle
			INNER JOIN dbo.Persona AS perBenFovis ON perBenFovis.perId = benFovis.benPersona
			INNER JOIN dbo.PersonaDetalle AS perDetBenFovis ON perDetBenFovis.pedPersona = perBenFovis.perId
			INNER JOIN dbo.SolicitudLegalizacionDesembolso ON dbo.SolicitudLegalizacionDesembolso.sldPostulacionFOVIS = dbo.PostulacionFOVIS.pofId
			INNER JOIN (SELECT dbo.LegalizacionDesembolso.lgdFechaTransferencia AS fechaTransferencia, dbo.LegalizacionDesembolso.lgdId AS id
					    FROM dbo.LegalizacionDesembolso
					    --WHERE LegalizacionDesembolso.lgdFechaTransferencia BETWEEN :fechaInicio AND :fechaFin
			 			) AS Legalizacion 
			ON Legalizacion.id = dbo.SolicitudLegalizacionDesembolso.sldLegalizacionDesembolso
			LEFT JOIN dbo.ProyectoSolucionVivienda ON dbo.ProyectoSolucionVivienda.psvId = dbo.PostulacionFOVIS.pofProyectoSolucionVivienda
			LEFT JOIN dbo.Oferente ON dbo.Oferente.ofeId = dbo.ProyectoSolucionVivienda.psvOferente AND  (dbo.Oferente.ofeEmpresa = empAportanteAfi.empId) 
			--LEFT JOIN dbo.Empresa ON dbo.Oferente.ofeEmpresa = dbo.Empresa.empId
			--LEFT JOIN dbo.Persona AS perEmpresaFovis ON perEmpresaFovis.perId = dbo.Empresa.empPersona
			INNER JOIN dbo.Solicitud ON dbo.SolicitudAsignacion.safSolicitudGlobal = dbo.Solicitud.solId
			LEFT JOIN dbo.SolicitudNovedad ON dbo.Solicitud.solId = dbo.SolicitudNovedad.snoSolicitudGlobal
			LEFT JOIN #FechasNovedadesSolicituNovedad AS novedadesAprobadas ON novedadesAprobadas.snoId = dbo.SolicitudNovedad.snoId
			LEFT JOIN dbo.ParametrizacionNovedad ON dbo.SolicitudNovedad.snoNovedad = dbo.ParametrizacionNovedad.novId
			LEFT JOIN dbo.NovedadDetalle ON (dbo.SolicitudNovedad.snoId = dbo.NovedadDetalle.nopId AND dbo.NovedadDetalle.nopVigente = 1)
			LEFT JOIN 
			(
				SELECT personaAfiliadoABeneficiario.perId AS idAfiABen, NULL AS idBenAAfi --se obtienen los afiliados que pasaron a ser beneficiarios
				FROM dbo.Afiliado AS afi1
				INNER JOIN dbo.RolAfiliado AS rolAfi1 ON (rolAfi1.roaAfiliado = afi1.afiId
						   AND rolAfi1.roaFechaRetiro IS NOT NULL AND rolAfi1.roaEstadoAfiliado = 'INACTIVO')
				INNER JOIN dbo.Persona AS personaAfiliadoABeneficiario ON afi1.afiPersona = personaAfiliadoABeneficiario.perId
				INNER JOIN dbo.Beneficiario AS ben1 ON (ben1.benPersona = afi1.afiPersona AND ben1.benEstadoBeneficiarioAfiliado = 'ACTIVO'
						   --AND benFovis.benId = ben1.benId
						   )
				UNION
				SELECT NULL AS idAfiABen, personaBeneficiarioAAFiliado.perId AS idBenAAfi -- se obtienen los beneficiarios que pasaron a ser afiliados
				FROM dbo.Beneficiario AS ben1
				INNER JOIN dbo.Persona AS personaBeneficiarioAAFiliado ON ben1.benPersona = personaBeneficiarioAAFiliado.perId
				INNER JOIN dbo.Afiliado AS afi1 ON afi1.afiPersona = ben1.benPersona --AND afi1.afiId = afiFovis.afiId
				INNER JOIN dbo.RolAfiliado AS rolAfi1 ON (rolAfi1.roaAfiliado = afi1.afiId AND rolAfi1.roaEstadoAfiliado = 'ACTIVO')
				WHERE ben1.benEstadoBeneficiarioAfiliado ='INACTIVO' AND ben1.benFechaRetiro IS NOT NULL
			) AS tablaNuevoAfiBen ON (tablaNuevoAfiBen.idBenAAfi = perJefeHogarAfiFovis.perId OR tablaNuevoAfiBen.idAfiABen = perBenFovis.perId)
			LEFT JOIN dbo.SolicitudNovedadFovis ON dbo.Solicitud.solId = dbo.SolicitudNovedadFovis.snfSolicitudGlobal
			LEFT JOIN #FechasNovedadesSolicituNovedadFovis AS novedadesFovisAprobadas ON novedadesFovisAprobadas.snfId = dbo.SolicitudNovedadFovis.snfId
			LEFT JOIN dbo.SolicitudNovedadPersonaFovis ON (dbo.SolicitudNovedadFovis.snfId = dbo.SolicitudNovedadPersonaFovis.spfSolicitudNovedadFovis 
					   AND dbo.PostulacionFOVIS.pofId = dbo.SolicitudNovedadPersonaFovis.spfPostulacionFovis)
			WHERE rolAfiFovis.roaEstadoAfiliado = 'ACTIVO' AND 
			( 
			  (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB', 'CAMBIO_NOMBRE_APELLIDOS_PERSONAS',
			   'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB', 'CAMBIO_GENERO_PERSONAS', 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS',
			    'AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO',
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO',    
			   'RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
			   'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
			   'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
			   'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
			   'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND  novedadesAprobadas.fechaRegistroNovedadCerrada BETWEEN @fechaInicio AND @fechaFin)
			   OR (dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND novedadesFovisAprobadas.fechaRegistroNovedadCerrada BETWEEN @fechaInicio AND @fechaFin)
			   OR
			   (
				   (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL)  AND benFovis.benFechaAfiliacion BETWEEN @fechaInicio AND @fechaFin
			   )
			)
