-- =============================================
-- Author:		Diego Suesca
-- Create date: 2019/03/14
-- Description:	Inserta datos para reporte 
-- =============================================
	CREATE PROCEDURE USP_GET_HistoricoNovedadesAfiliadosYSubsidios
	(
		@fechaInicio DATE,
		@fechaFin DATE,
		@historico BIT = NULL
	)
	AS
	BEGIN TRY

		SET NOCOUNT ON;

		DECLARE @DBNAME VARCHAR(255),
				@sql NVARCHAR(4000);

		--DROP TABLE #PersonasModificacionDatosBasicos
		--DROP TABLE #FechasNovedadesSolicituNovedad
		--DROP TABLE #FechasNovedadesSolicituNovedadFovis
			CREATE TABLE #PersonasModificacionDatosBasicos(perId BIGINT, actualNumeroId VARCHAR(16) , actualTipoId VARCHAR(20), anteriorNumeroId VARCHAR(16), anteriorTipoId VARCHAR(20), sl VARCHAR(500) )
		CREATE TABLE #FechasNovedadesSolicituNovedad(snoId BIGINT, fechaRegistroNovedadCerrada DATE, sl VARCHAR(500))
		CREATE TABLE #FechasNovedadesSolicituNovedadFovis(snfId BIGINT, fechaRegistroNovedadCerrada DATE, sl VARCHAR(500))

		--se obtienen las personas que se les ha cambiado el numero de identificación y/ó el tipo de documento de identificación
		SET @sql = '
		 SELECT DISTINCT perA.perid, perA.perNumeroIdentificacion actualNumeroId, perA.perTipoIdentificacion actualTipoId,
		 	    aux.perNumeroIdentificacion anteriorNumeroId, aux.perTipoIdentificacion anterioTipoId 
		 FROM Persona_aud perA
		 INNER JOIN ( 
			 SELECT per.perId,per.REV,per.perNumeroIdentificacion, per.perTipoIdentificacion
			 FROM Persona_aud per 
			 inner JOIN Persona_aud perAux ON perAux.perId = per.perId AND perAux.perNumeroIdentificacion <> per.perNumeroIdentificacion
			 GROUP BY per.perNumeroIdentificacion, per.perTipoIdentificacion,per.REV,per.perId 
		 ) aux ON aux.perId = perA.perId AND aux.perNumeroIdentificacion <> perA.pernumeroidentificacion AND aux.Rev < perA.REV
		 UNION
		 SELECT DISTINCT perB.perid, perB.perNumeroIdentificacion actualNumeroId, perB.perTipoIdentificacion actualTipoId,
		 	    tablaAux.perNumeroIdentificacion anteriorNumeroId, tablaAux.perTipoIdentificacion anterioTipoId  
		 FROM Persona_aud perB
		 INNER JOIN(
		 	 SELECT  per.perId, per.REV, per.perNumeroIdentificacion, per.perTipoIdentificacion
			 FROM Persona_aud per 
			 INNER JOIN dbo.Persona_aud perAux ON perAux.perId = per.perId AND perAux.perTipoIdentificacion <> per.perTipoIdentificacion
			 GROUP BY per.perNumeroIdentificacion, per.perTipoIdentificacion,per.REV,per.perId 
		 ) tablaAux ON tablaAux.perId = perB.perId AND tablaAux.perTipoIdentificacion <> perB.perTipoIdentificacion  AND tablaAux.Rev < perB.REV '
		 
		
		INSERT INTO #PersonasModificacionDatosBasicos (perId , actualNumeroId, actualTipoId, anteriorNumeroId, anteriorTipoId, sl)
		EXEC sp_execute_remote CoreAudReferenceData, @sql	
		
		--SE OBTIENEN LAS FECHAS DE REGISTRO DE LAS NOVEDADES QUE ESTUVIERON APROBADAS Y LUEGO CERRADAS CON EL ID DE LA SOLICITUD DE NOVEDAD
		SET @sql = '
		SELECT sno.snoId, CAST(CONVERT(VARCHAR(10), dateadd(second, revTimeStamp / 1000, ''19700101'') AT TIME ZONE ''UTC'' AT TIME ZONE ''SA Pacific Standard Time'' ) AS DATE) AS fechaRegistroNovedadCerrada
		FROM SolicitudNovedad_aud sno 
		INNER JOIN Revision rev ON (sno.REV = rev.revId)
		INNER JOIN(
			SELECT sno1.snoId, sno1.REV  
			FROM  SolicitudNovedad_aud sno1 
			WHERE sno1.snoEstadoSolicitud = ''APROBADA''
			GROUP BY sno1.snoId,sno1.REV 
		) aux ON aux.snoId = sno.snoId AND aux.REV < sno.REV
		WHERE sno.snoEstadoSolicitud = ''CERRADA''
		GROUP BY sno.snoId, revTimeStamp'
		
		INSERT INTO #FechasNovedadesSolicituNovedad(snoId, fechaRegistroNovedadCerrada, sl)
		EXEC sp_execute_remote CoreAudReferenceData, @sql	
		
	   --SE OBTIENEN LAS FECHAS DE REGISTRO DE LAS NOVEDADES DE FOVISO QUE FUERON APROBADAS Y LUEGO CERRADAS CON EL ID DE LA SOLICITUD DE NOVEDAD FOVIS
		SET @sql = '
			SELECT sno.snfId, CAST(CONVERT(VARCHAR(10), dateadd(second, revTimeStamp / 1000, ''19700101'') AT TIME ZONE ''UTC'' AT TIME ZONE ''SA Pacific Standard Time'' ) AS DATE) AS fechaRegistroNovedadCerrada
		FROM SolicitudNovedadFovis_aud sno 
		INNER JOIN Revision rev ON (sno.REV = rev.revId)
		INNER JOIN(
			SELECT sno1.snfId, sno1.REV  
			FROM SolicitudNovedadFovis_aud sno1 
			WHERE sno1.snfEstadoSolicitud = ''NOV_FOVIS_APROBADA''
			GROUP BY sno1.snfId,sno1.REV 
		) aux ON aux.snfId = sno.snfId AND aux.REV < sno.REV
		WHERE sno.snfEstadoSolicitud = ''NOV_FOVIS_CERRADA''
		GROUP BY sno.snfId, revTimeStamp'
		
		INSERT INTO #FechasNovedadesSolicituNovedadFovis(snfId, fechaRegistroNovedadCerrada, sl)
		EXEC sp_execute_remote CoreAudReferenceData, @sql	

		IF @historico = 1
		BEGIN
			INSERT rno.HistoricoNovedadesAfiliadosYSubsidios(
				hnaFechaHistorico,
				hnaTipoRegistro,
				hnaCodigoCCF,
				hnaTipoIdAfiliado,
				hnaNumeroIdAfiliado,
				hnaCodigoGeneroAfiliado,
				hnaFechaNacimientoAfiliado,
				hnaPrimerApellidoAfiliado,
				hnaSegundoApellidoAfiliado,
				hnaPrimerNombreAfiliado,
				hnaSegundoNombreAfiliado,
				hnaCodigoNovedad,
				hnaTipoIdAfiliado2,
				hnaNumeroIdAfiliado2,
				hnaCodigoGeneroAfiliado2,
				hnaFechaNacimientoAfiliado2,
				hnaPrimerApellidoAfiliado2,
				hnaSegundoApellidoAfiliado2,
				hnaPrimerNombreAfiliado2,
				hnaSegundoNombreAfiliado2,
				hnaDepartamentoAfiliado,
				hnaMunicipioAfiliado,
				hnaFechaAfiliacion,
				hnaVARIABLE12,
				hnaCodigoTipoAfiliado,
				hnaTipoIdAportante,
				hnaNumeroIdAportante,
				hnaDigitoVerificacionAportante,
				hnaRazonSocialAportante,
				hnaFechaVinculacionAportante,
				hnaDepartamentoUbicacion,
				hnaMunicipioUbicacion,
				hnaVARIABLE21,
				hnaVARIABLE22,
				hnaCodigoTipoMiembroPoblacionCubierta,
				hnaTipoIdMiembroPoblacionCubierta,
				hnaNumeroIdMiembroPoblacionCubierta,
				hnaCodigoCondicionBeneficiario,
				hnaCodigoTipoRelacionConAfiliadoBen,
				hnaFechaAsignacionSubsidio,
				hnaValorSubsidio,
				hnaCodigoTipoSubsidio,
				hnaEstadoSubsidio,
				hnaDepartamentoSubsidio,
				hnaMunicipioSubsidio,
				hnaFechaEntregaUltimoSubsidio,
				hnaFechaDesvinculacionAportante,
				hnaFechaRetiroAfiliado,
				hnaFechaFallecimiento,
				hnaTipoIdbeneficiario,
				hnaNumeroIdBeneficiario,
				hnaVARIABLE40,
				hnaVARIABLE41,
				hnaVARIABLE42,
				hnaVARIABLE43,
				hnaVARIABLE44,
				hnaVARIABLE45,
				hnaVARIABLE46,
				hnaVARIABLE47,
				hnaVARIABLE48,
				hnaVARIABLE49,
				hnaVARIABLE50,
				hnaVARIABLE51,
				hnaVARIABLE52,
				hnaVARIABLE53,
				hnaVARIABLE54,
				hnaIdentificadorUnicoSubsidio,
				hnaNuevoTipoIdMiembrePoblacionCubierta,
				hnaNuevoNumeroIdMiembroPoblacionCubierta,
				hnaCausaRetiro,
				hnaFechaInicialReporte,
				hnaFechaFinalReporte
)

SELECT @fechaFin,
			2 AS tipoRegistro,
			(SELECT cnsValor FROM dbo.Constante WHERE cnsNombre = 'CAJA_COMPENSACION_CODIGO') AS codigoCCF,
			CASE perAfiCore.perTipoIdentificacion 
			    WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN 'PASAPORTE' THEN 'PA'
			    WHEN 'CARNE_DIPLOMATICO' THEN 'CD' 
			END AS tipoIdAfiliado,
			perAfiCore.perNumeroIdentificacion AS numeroIdAfiliado,
			CASE perDetAfiCore.pedGenero
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroAfiliado,
			perDetAfiCore.pedFechaNacimiento AS fechaNacimientoAfiliado,
			SUBSTRING(perAfiCore.perPrimerApellido,0,60) AS primerApellidoAfiliado,
			SUBSTRING(perAfiCore.perSegundoApellido,0,60) AS segundoApellidoAfiliado,
			SUBSTRING(perAfiCore.perPrimerNombre,0,60) AS primerNombreAfiliado,
			SUBSTRING(perAfiCore.perSegundoNombre,0,60) AS segundoNombreAfiliado,
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')
				     THEN 'C01'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB')
					THEN 'C02'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')
					THEN 'C03'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
					-- ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE')
					THEN 'C04'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('REPORTE_INVALIDEZ_PERSONAS','REPORTE_INVALIDEZ_PERSONAS_DEPWEB','REPORTE_INVALIDEZ_PERSONAS_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_WEB')
			     	 THEN 'C07'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')
						--('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS','RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6','RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO','RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA','RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA')
 					--AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					 THEN 'C08'
			   --WHEN ( SELECT CASE WHEN EXISTS (SELECT abono.casId FROM dbo.CuentaAdministradorSubsidio abono WHERE abono.casId = cuenta.casId AND abono.casEstadoLiquidacionSubsidio = 'COBRADO' AND abono.casIdCuentaAdmonSubsidioRelacionado IN ( SELECT CuentaAdministradorSubsidio.casId FROM CuentaAdministradorSubsidio WHERE CuentaAdministradorSubsidio.casTipoTransaccionSubsidio = 'RETIRO' AND CuentaAdministradorSubsidio.casFechaHoraCreacionRegistro BETWEEN @fechaInicio AND @fechaFin) UNION SELECT detalleAux.dsaCuentaAdministradorSubsidio FROM dbo.DetalleSubsidioAsignado detalleAux WHERE detalle.dsaId = detalleAux.dsaId AND detalleAux.dsaOrigenRegistroSubsidio IN('LIQUIDACION_SUBSIDIO_MONETARIO', 'DERECHO_ASIGNADO_RETENIDO') AND detalleAux.dsaFechaHoraCreacion BETWEEN @fechaInicio AND @fechaFin ) THEN 1 ELSE 0 END ) = 1

			   	--	THEN 'C09' Las novedades de subsidio de pasan al siguiente 
			END AS codigoNovedad,
			--==== INICIA NOVEDAD C02 =====
			CASE  
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB') AND -- CODIGO NOVEDAD C02
			    	 perAfiCore.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB') AND -- CODIGO NOVEDAD C02
			    	 perAfiCore.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB') AND -- CODIGO NOVEDAD C02
			    	 perAfiCore.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB') AND -- CODIGO NOVEDAD C02
			    	 perAfiCore.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB') AND -- CODIGO NOVEDAD C02
			    	 perAfiCore.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD' 
			    ELSE NULL
			END AS tipoIdAfiliado2, -- VARIABLE 1
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL','ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB')  -- CODIGO NOVEDAD C02
				THEN perAfiCore.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdAfiliado2, -- VARIABLE 2
			--========= FIN NOVEDAD C02 ========
			--========= INICIA NOVEDAD C01 =====
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01 
					 AND perDetAfiCore.pedGenero = 'FEMENINO' THEN 'F'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetAfiCore.pedGenero = 'MASCULINO' THEN 'M'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetAfiCore.pedGenero ='INDEFINIDO' THEN 'I'
				ELSE NULL
			END AS codigoGeneroAfiliado2, -- VARIABLE 3
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perDetAfiCore.pedFechaNacimiento
				ELSE NULL
			END AS fechaNacimientoAfiliado2, -- VARIABLE 4
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN SUBSTRING(perAfiCore.perPrimerApellido,0,60)
				ELSE NULL
			END AS primerApellidoAfiliado2, -- VARIABLE 5
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perAfiCore.perSegundoApellido
				ELSE NULL
			END AS segundoApellidoAfiliado2, -- VARIABLE 6
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perAfiCore.perPrimerNombre
				ELSE NULL
			END AS primerNombreAfiliado2, -- VARIABLE 7
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perAfiCore.perSegundoNombre
				ELSE NULL
			END AS segundoNombreAfiliado2, -- VARIABLE 8
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')
				THEN depAfiCore.depCodigo
				ELSE NULL
			END AS departamentoAfiliado, -- VARIABLE 9
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN munAfiCore.munCodigo
				ELSE NULL
			END AS municipioAfiliado, -- VARIABLE 10
			--========= FIN NOVEDAD C01 ================
			--====== INICIA NOVEDAD C03 Y C07 ============
			CASE WHEN --dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --CODIGO NOVEDAD C03
					 --'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO')
					 dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_RAZON_SOCIAL_NOMBRE')
				THEN aporteGenAfiCore.empFechaCambioEstadoAfiliacion
			    --WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','REPORTE_INVALIDEZ_PERSONAS','REPORTE_INVALIDEZ_PERSONAS_DEPWEB','REPORTE_INVALIDEZ_PERSONAS_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_WEB')
			     AND snp.snpBeneficiario IS NULL THEN rolAfiCore.roaFechaIngreso
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','REPORTE_INVALIDEZ_PERSONAS','REPORTE_INVALIDEZ_PERSONAS_DEPWEB','REPORTE_INVALIDEZ_PERSONAS_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_WEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_WEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_DEPWEB','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_PRESENCIAL','ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_WEB')
			     AND snp.snpBeneficiario IS NOT NULL THEN benCore.benFechaAfiliacion
				ELSE NULL
			END AS fechaAfiliacion, -- VARIABLE 11
			NULL AS VARIABLE12,
			--====== FIN NOVEDAD C07 ============
			---===== INICIA NOVEDAD C03 ========
			CASE
				--WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO','AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))	  
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE') -- NOVEDAD C03
				AND rolAfiCore.roaTipoAfiliado = 'TRABAJADOR_DEPENDIENTE' THEN 1
				--WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO','AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))	  
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE') -- NOVEDAD C03
					AND	 rolAfiCore.roaTipoAfiliado = 'TRABAJADOR_INDEPENDIENTE' THEN 2 --2 - Trabajador afiliado facultativo
				--WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO','AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))	  
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE') -- NOVEDAD C03
					 AND rolAfiCore.roaTipoAfiliado = 'PENSIONADO' THEN 3
				ELSE NULL
			END AS codigoTipoAfiliado, -- VARIABLE 13
			---===== INICIA NOVEDAD C04, CONTINUA C03 ========
			CASE
				WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perAportanteAfiCore.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
				WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perAportanteAfiCore.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perAportanteAfiCore.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
				WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perAportanteAfiCore.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perAportanteAfiCore.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perEmpAportanteAfiCore.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perEmpAportanteAfiCore.perTipoIdentificacion ='TARJETA_IDENTIDAD' THEN 'TI'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perEmpAportanteAfiCore.perTipoIdentificacion ='CEDULA_EXTRANJERIA' THEN 'CE'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perEmpAportanteAfiCore.perTipoIdentificacion ='PASAPORTE' THEN 'PA'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 AND perEmpAportanteAfiCore.perTipoIdentificacion ='CARNE_DIPLOMATICO' THEN 'CD'
				ELSE NULL
			END AS tipoIdAportante, -- VARIABLE 14
			CASE 
				WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 THEN perAportanteAfiCore.perNumeroIdentificacion 
				WHEN (aporteGenAfiCore.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 THEN perEmpAportanteAfiCore.perNumeroIdentificacion 
				ELSE NULL
			END AS numeroIdAportante, -- VARIABLE 15
			CASE 
				WHEN (aporteGenAfiCore.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --NOVEDAD C04
					 OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')) --NOVEDAD C03
					 THEN perEmpAportanteAfiCore.perDigitoVerificacion
				ELSE NULL
			END AS digitoVerificacionAportante, -- VARIABLE 16
			--======== FIN NOVEDAD C04 =========
			--==================================
			CASE 
				WHEN (aporteGenAfiCore.apgPersona IS NOT NULL AND  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE'))--NOVEDAD C03
				THEN CONCAT(perAportanteAfiCore.perPrimerNombre,' ',perAportanteAfiCore.perSegundoNombre, ' ', perAportanteAfiCore.perPrimerApellido, ' ',perAportanteAfiCore.perSegundoApellido)
				WHEN (aporteGenAfiCore.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE'))--NOVEDAD C03
				THEN perEmpAportanteAfiCore.perRazonSocial
				ELSE NULL
			END AS razonSocialAportante,-- VARIABLE 17
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')-- NOVEDAD C03
				THEN aporteGenAfiCore.roaFechaAfiliacion 
				ELSE NULL
			END AS fechaVinculacionAportante,--VARIABLE 18
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')-- NOVEDAD C03
				THEN depEmpAportanteAfiCore.depCodigo 
				ELSE NULL
			END AS departamentoUbicacion,--VARIABLE 19
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')-- NOVEDAD C03
				THEN munEmpAportanteAfiCore.munCodigo 
				ELSE NULL
			END AS municipioUbicacion,--VARIABLE 20
			NULL AS VARIABLE21,
			NULL AS VARIABLE22,
			--========================= FIN NOVEDAD C03 ==================
			--============================================================
			--ESTADO AFILIACIÓN 21: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--AL DIA (1- AL DIA O 2- EN MORA) 22: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--- ================= INICIO NOVEDAD 'C07' ================-----
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')-- NOVEDAD C03
			     	 AND snp.snpBeneficiario IS NULL THEN 1
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL','CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB','CAMBIO_RAZON_SOCIAL_NOMBRE')-- NOVEDAD C03
			     	 AND snp.snpBeneficiario IS NOT NULL THEN 2
				ELSE NULL
			END AS codigoTipoMiembroPoblacionCubierta, -- VARIABLE 23
			---==== FIN ULTIMO CAMPO NOVEDAD C03 ============
			--- === NOVEDADES 'C07' Y 'C08' =================
			CASE
				WHEN snp.snpBeneficiario IS NOT NULL THEN perBenCore.perTipoIdentificacion
				WHEN snp.snpBeneficiario IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN (
											'REPORTE_INVALIDEZ_PERSONAS',
											'REPORTE_INVALIDEZ_PERSONAS_DEPWEB',
											'REPORTE_INVALIDEZ_PERSONAS_WEB') THEN perAfiCore.perTipoIdentificacion
			END AS tipoIdMiembroPoblacionCubierta, -- VARIABLE 24
			CASE
				WHEN snp.snpBeneficiario IS NOT NULL THEN perBenCore.perNumeroIdentificacion
				WHEN snp.snpBeneficiario IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN (
											'REPORTE_INVALIDEZ_PERSONAS',
											'REPORTE_INVALIDEZ_PERSONAS_DEPWEB',
											'REPORTE_INVALIDEZ_PERSONAS_WEB') THEN perAfiCore.perNumeroIdentificacion
			END AS numeroIdMiembroPoblacionCubierta, -- VARIABLE 25
			--- ==== FIN NOVEDAD 'C08' ========

			CASE
				WHEN benCore.benGradoAcademico IS NOT NULL AND benDetCore.bedCertificadoEscolaridad = 1 THEN 'E' --ESTUDIANTE
				WHEN benCore.benGradoAcademico IS NULL AND benDetCore.bedCertificadoEscolaridad = 0 THEN 'D' --DISCAPACITADO
				ELSE NULL
			END AS codigoCondicionBeneficiario, -- VARIABLE 26
			CASE
				WHEN benCore.benTipoBeneficiario = 'CONYUGE' THEN 1
				WHEN benCore.benTipoBeneficiario IN ('HIJO_BIOLOGICO','HIJO_ADOPTIVO','HIJASTRO','BENEFICIARIO_EN_CUSTODIA') THEN 2
				WHEN benCore.benTipoBeneficiario IN ('PADRE','MADRE') THEN 3
				WHEN benCore.benTipoBeneficiario IN ('HERMANO_HUERFANO_DE_PADRES','HERMANO_HOGAR') THEN 4
				ELSE NULL
			END AS codigoTipoRelacionConAfiliadoBen, -- VARIABLE 27
			--- ================= FIN NOVEDAD 'C07' =====================-----
			--- ================= INICIO NOVEDAD 'C09' ====================----
			NULL AS fechaAsignacionSubsidio, -- VARIABLE 28
			NULL AS valorSubsidio, -- VARIABLE 29
			NULL AS codigoTipoSubsidio, -- VARIABLE 30
			NULL AS estadoSubsidio, -- VARIABLE 31 				--codigoNovedad = 'C09'
			NULL AS departamentoSubsidio, -- VARIABLE 32
			NULL AS municipioSubsidio,   -- VARIABLE 33
			NULL AS fechaEntregaUltimoSubsidio, -- VARIABLE 34
			--- ================= FIN NOVEDAD 'C09' =====================
			--===================================================
			--================== INICIO NOVEDAD C04 ===========================
			CASE
				WHEN  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
				THEN aporteGenAfiCore.roaFechaRetiro
				ELSE NULL
			END AS fechaDesvinculacionAportante, -- VARIABLE 35
			 ---== NOVEDADES C04 Y C08 ====---
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					 AND rolAfiCore.roaFechaRetiro IS NOT NULL
				THEN rolAfiCore.roaFechaRetiro
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB') -- NOVEDAD C08
				AND benCore.benFechaRetiro IS NOT NULL
				THEN benCore.benFechaRetiro
				ELSE NULL
			END AS fechaRetiroAfiliado, -- VARIABLE 36
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					  AND perDetAfiCore.pedFechaFallecido IS NOT NULL)
					 THEN perDetAfiCore.pedFechaFallecido
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB') --codigoNovedad = C08
					  AND perDetBenCore.pedFechaFallecido IS NOT NULL) THEN perDetBenCore.pedFechaFallecido
				ELSE NULL
			END AS fechaFallecimiento, -- VARIABLE 37
			--============= FIN NOVEDAD C04  ===========
			--- ================= INICIO NOVEDAD 'C09' ====================----
			NULL AS tipoIdbeneficiario, -- VARIABLE 38 codigoNovedad = 'C09'
			NULL AS numeroIdBeneficiario, -- VARIABLE 39
			NULL AS VARIABLE40,
			NULL AS VARIABLE41,
			NULL AS VARIABLE42,
			NULL AS VARIABLE43,
			NULL AS VARIABLE44,
			NULL AS VARIABLE45,
			NULL AS VARIABLE46,
			NULL AS VARIABLE47,
			NULL AS VARIABLE48,
			NULL AS VARIABLE49,
			NULL AS VARIABLE50,
			NULL AS VARIABLE51,
			NULL AS VARIABLE52,
			NULL AS VARIABLE53,
			NULL AS VARIABLE54,
			--- ================= FIN NOVEDAD 'C09' =====================
			/*CASE perDetBenFovis.pedGenero   --TODO: DEL CAMPO 40 AL 54 NO SE USAN
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroBeneficiario,
			perDetBenFovis.pedFechaExpedicionDocumento AS fechaNacimientoBeneficiario,
			perBenFovis.perPrimerApellido AS primerApellidoBeneficiario,
			perBenFovis.perSegundoApellido AS segundoApellidoBeneficiario,
			perBenFovis.perPrimerNombre  AS primerNombreBeneficiario,
			perBenFovis.perSegundoNombre AS segundoNombreBeneficiario,
			CASE perEmpAportanteAfi.perTipoIdentificacion--perEmpresaFovis.perTipoIdentificacion
			    WHEN 'CEDULA_CIUDADANIA' THEN 1
				WHEN 'NIT' THEN 2
			END AS tipoIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perNumeroIdentificacion
			perEmpAportanteAfi.perNumeroIdentificacion AS numeroIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perDigitoVerificacion 
			perEmpAportanteAfi.perDigitoVerificacion AS digitoVerificacionIdEmpresaSubsidio,
			--perEmpresaFovis.perRazonSocial 
			perEmpAportanteAfi.perRazonSocial AS razonSocialEmpresaSubsidio,
			1 AS aQuienSeOtorgoSubsidio, 
			':fechaInicio' AS fechaInicialPeriodoInformacion,
			':fechaFin' AS fechaFinalPeriodoInformacion,
			0 AS totalRegistroRelacionadosArchivo,
			':nombreReporte' AS nombreDelArchivo,*/ 
			NULL AS identificadorUnicoSubsidio, -- VARIABLE 55
			NULL AS nuevoTipoIdMiembrePoblacionCubierta,  --VARIABLE 56
			NULL AS nuevoNumeroIdMiembroPoblacionCubierta, -- VARIABLE 57
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
						OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
					 AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					 AND rolAfiCore.roaFechaRetiro IS NOT NULL AND rolAfiCore.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR'
					 THEN 1
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
						OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
					 AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					  AND ((rolAfiCore.roaFechaRetiro IS NOT NULL AND rolAfiCore.roaMotivoDesafiliacion = 'FALLECIMIENTO') OR
					 (benCore.benFechaRetiro IS NOT NULL AND benCore.benMotivoDesafiliacion = 'FALLECIMIENTO')) THEN 2
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
						OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
					 AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					 AND (rolAfiCore.roaMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' OR
					 aporteGenAfiCore.empMotivoDesafiliacion = 'RETIRO_POR_TRASLADO_OTRA_CCF' OR benCore.benMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' )
					 THEN 3
			    WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
						OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
						AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
			    	  AND dbo.ParametrizacionNovedad.novTipoTransaccion = 'SUSTITUCION_PATRONAL' THEN 6
			    WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
						OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
					 AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					 AND aporteGenAfiCore.empMotivoDesafiliacion = 'FUSION_ADQUISICION'
					  AND rolAfiCore.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR' THEN 7
			 	--TODO: FALTAN LAS CAUSAS DE RETIRO DE LA 4 A LA 12
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE')
					OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB')) --codigoNovedad = C08
					 AND (benCore.benFechaRetiro IS NOT NULL OR rolAfiCore.roaFechaRetiro IS NOT NULL )
					 AND benCore.benFechaRetiro IS NOT NULL AND benCore.benMotivoDesafiliacion = 'OTROS' THEN 30
				ELSE NULL
			END AS causaRetiro,
			@fechaInicio,
			@fechaFin
			--sno.snoId,
			--dbo.ParametrizacionNovedad.novTipoTransaccion,
			--snp.snpBeneficiario
			FROM dbo.Afiliado AS afiCore
			INNER JOIN dbo.RolAfiliado AS rolAfiCore ON rolAfiCore.roaAfiliado = afiCore.afiId
			INNER JOIN dbo.Persona AS perAfiCore ON afiCore.afiPersona = perAfiCore.perId
			LEFT JOIN dbo.Ubicacion AS ubiAfiCore ON ubiAfiCore.ubiId = perAfiCore.perUbicacionPrincipal
			LEFT JOIN dbo.Municipio AS munAfiCore ON munAfiCore.munId = ubiAfiCore.ubiMunicipio
			LEFT JOIN dbo.Departamento AS depAfiCore ON depAfiCore.depId = munAfiCore.munDepartamento
			INNER JOIN dbo.PersonaDetalle AS perDetAfiCore ON perAfiCore.perId = perDetAfiCore.pedPersona
			-- Novedades Persona
			LEFT JOIN dbo.SolicitudNovedadPersona AS snp ON snp.snpPersona = afiCore.afiPersona
			-- Fechas de las novedades persona
			LEFT JOIN dbo.SolicitudNovedad AS sno ON snp.snpSolicitudNovedad = sno.snoId
			LEFT JOIN dbo.ParametrizacionNovedad ON sno.snoNovedad = dbo.ParametrizacionNovedad.novId
			LEFT JOIN #FechasNovedadesSolicituNovedad AS novedadesAprobadas ON novedadesAprobadas.snoId = sno.snoId
			LEFT JOIN (
						SELECT CASE WHEN afiRol.roaEmpleador IS NOT NULL THEN NULL ELSE afi.afiPersona END apgPersona, 
								empleadorAporte.empEmpresa apgEmpresa,
							   	afiRol.roaFechaAfiliacion,
							   	afiRol.roaFechaRetiro,
							   	afiRol.roaId,
							   	empleadorAporte.empMotivoDesafiliacion,
							   	empleadorAporte.empFechaCambioEstadoAfiliacion
						FROM dbo.RolAfiliado AS afiRol
						LEFT JOIN dbo.Empleador AS empleadorAporte ON empleadorAporte.empId = afiRol.roaEmpleador
						LEFT JOIN dbo.Afiliado afi ON afi.afiId = afiRol.roaAfiliado
			) AS aporteGenAfiCore ON aporteGenAfiCore.roaId = rolAfiCore.roaId
			LEFT JOIN dbo.Persona AS perAportanteAfiCore ON perAportanteAfiCore.perId = aporteGenAfiCore.apgPersona
			LEFT JOIN dbo.Empresa AS empAportanteAfiCore ON empAportanteAfiCore.empId = aporteGenAfiCore.apgEmpresa
			LEFT JOIN dbo.Persona AS perEmpAportanteAfiCore ON perEmpAportanteAfiCore.perId = empAportanteAfiCore.empPersona
			LEFT JOIN dbo.UbicacionEmpresa ube ON ube.ubeEmpresa = empAportanteAfiCore.empId AND ube.ubeTipoUbicacion='UBICACION_PRINCIPAL'
			LEFT JOIN dbo.Ubicacion AS ubiEmpAportanteAfiCore ON ubiEmpAportanteAfiCore.ubiId = ube.ubeUbicacion
			LEFT JOIN dbo.Municipio AS munEmpAportanteAfiCore ON munEmpAportanteAfiCore.munId = ubiEmpAportanteAfiCore.ubiMunicipio
			LEFT JOIN dbo.Departamento AS depEmpAportanteAfiCore ON depEmpAportanteAfiCore.depId = munEmpAportanteAfiCore.munDepartamento
			LEFT JOIN dbo.Beneficiario AS benCore ON afiCore.afiId = benCore.benAfiliado AND snp.snpBeneficiario = benCore.benId
			LEFT JOIN dbo.BeneficiarioDetalle AS benDetCore ON benDetCore.bedId = benCore.benBeneficiarioDetalle
			LEFT JOIN dbo.Persona AS perBenCore ON perBenCore.perId = benCore.benPersona
			LEFT JOIN dbo.PersonaDetalle AS perDetBenCore ON perDetBenCore.pedPersona = perBenCore.perId
			WHERE 1=1
			AND rolAfiCore.roaEstadoAfiliado = 'ACTIVO'
			AND ((dbo.ParametrizacionNovedad.novTipoTransaccion IN (
								'REPORTE_INVALIDEZ_PERSONAS',
								'REPORTE_INVALIDEZ_PERSONAS_DEPWEB',
								'REPORTE_INVALIDEZ_PERSONAS_WEB'))
				OR (snp.snpBeneficiario IS NULL 
					AND dbo.ParametrizacionNovedad.novTipoTransaccion IN (
								'CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB',
								'CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL',
								'CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB',
								'CAMBIO_GENERO_PERSONAS',
								'CAMBIO_NOMBRE_APELLIDOS_PERSONAS',
								'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB',
								'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB',
								'CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB',
								'CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL',
								'CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB',
								'CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS',
								'CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB',
								'CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB',
								'ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR',
								'ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_DEPWEB',
								'ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_PRESENCIAL',
								'ACTUALIZAR_DOCUMENTO_IDENTIDAD_PERSONA_WEB',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_PRESENCIAL',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_0_6_WEB',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_PRESENCIAL',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MAYOR_1_5SM_2_WEB',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_PRESENCIAL',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_6_WEB',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_PRESENCIAL',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_0_WEB',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_PRESENCIAL',
								'CAMBIO_TIPO_PENSIONADO_PENSIONADO_MENOR_1_5SM_2_WEB',
								'CAMBIO_RAZON_SOCIAL_NOMBRE',
								'ACTUALIZACION_MUNICIPIO_DESEMPEÑO_LABORES',
								'RETIRO_TRABAJADOR_DEPENDIENTE'))
				OR 	(snp.snpBeneficiario IS NOT NULL 
					AND dbo.ParametrizacionNovedad.novTipoTransaccion IN (
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_DEPWEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_BENEFICIARIO_EN_CUSTODIA_WEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_DEPWEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_PRESENCIAL',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HERMANO_HUERFANO_WEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_DEPWEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_PRESENCIAL',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJASTRO_WEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_DEPWEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_PRESENCIAL',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_ADOPTIVO_WEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_DEPWEB',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_PRESENCIAL',
								'ACTUALIZACION_ESCOLARIDAD_ESTUDIANTE_EDUCACION_BASICA_MEDIA_HIJO_BIOLOGICO_WEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_DEPWEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_PRESENCIAL',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_BENEFICIARIO_EN_CUSTODIA_WEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_DEPWEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_PRESENCIAL',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HERMANO_HUERFANO_WEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_DEPWEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_PRESENCIAL',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJASTRO_WEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_DEPWEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_PRESENCIAL',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_ADOTIVO_WEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_DEPWEB',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_PRESENCIAL',
								'ACTUALIZACION_CERTIFICADO_ESTUDIOS_HIJO_BIOLOGICO_WEB',
								'INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB',
								'INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL',
								'INACTIVAR_BENEFICIARIO_CONYUGE_WEB',
								'INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB',
								'INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL',
								'INACTIVAR_BENEFICIARIO_HIJASTRO_WEB',
								'INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB',
								'INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL',
								'INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB',
								'INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB',
								'INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL',
								'INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB',
								'INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB',
								'INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL',
								'INACTIVAR_BENEFICIARIO_HUERFANO_WEB'
								--'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' aparte en consulta para novedad C10
								))
				)
			AND  novedadesAprobadas.fechaRegistroNovedadCerrada BETWEEN @fechaInicio AND @fechaFin
		UNION ALL -- PARTE FOVIS
		SELECT @fechaFin,
			2 AS tipoRegistro,
			(SELECT cnsValor FROM dbo.Constante WHERE cnsNombre = 'CAJA_COMPENSACION_CODIGO') AS codigoCCF,
			CASE perJefeHogarAfiFovis.perTipoIdentificacion 
			    WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN 'PASAPORTE' THEN 'PA'
			    WHEN 'CARNE_DIPLOMATICO' THEN 'CD' 
			END AS tipoIdAfiliado,
			perJefeHogarAfiFovis.perNumeroIdentificacion AS numeroIdAfiliado,
			CASE perDetJefeHogarAfiFovis.pedGenero
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroAfiliado,
			perDetJefeHogarAfiFovis.pedFechaNacimiento AS fechaNacimientoAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perPrimerApellido,0,60) AS primerApellidoAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perSegundoApellido,0,60) AS segundoApellidoAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perPrimerNombre,0,60) AS primerNombreAfiliado,
			SUBSTRING(perJefeHogarAfiFovis.perSegundoNombre,0,60) AS segundoNombreAfiliado,
			CASE
				     WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB', 'CAMBIO_NOMBRE_APELLIDOS_PERSONAS',
           			'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB', 'CAMBIO_GENERO_PERSONAS')
				     THEN 'C01'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' THEN 'C02'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO',
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
					THEN 'C03' 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE') 
					THEN 'C04'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('INACTIVAR_BENEFICIARIO_CONYUGE_DEPWEB','INACTIVAR_BENEFICIARIO_CONYUGE_PRESENCIAL','INACTIVAR_BENEFICIARIO_CONYUGE_WEB','INACTIVAR_BENEFICIARIO_HIJASTRO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJASTRO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJASTRO_WEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_ADOPTIVO_WEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_DEPWEB','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HIJO_BIOLOGICO_WEB','INACTIVAR_BENEFICIARIO_HUERFANO_DEPWEB','INACTIVAR_BENEFICIARIO_HUERFANO_PRESENCIAL','INACTIVAR_BENEFICIARIO_HUERFANO_WEB') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) 
					 THEN 'C08'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL 
			    	THEN 'C09' --si tiene registro en la tabla SolicituNovedadFovis es porque se realizo algún cambio en el subsidio
			END AS codigoNovedad,
			--==== INICIA NOVEDAD C02 =====
			CASE  
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' AND -- CODIGO NOVEDAD C02
			    	 perJefeHogarAfiFovis.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD' 
			    ELSE NULL
			END AS tipoIdAfiliado2, -- VARIABLE 1
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion = 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS' -- CODIGO NOVEDAD C02
				THEN perJefeHogarAfiFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdAfiliado2, -- VARIABLE 2
			--========= FIN NOVEDAD C02 ========
			--========= INICIA NOVEDAD C01 =====
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01 
					 AND perDetJefeHogarAfiFovis.pedGenero = 'FEMENINO' THEN 'F'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetJefeHogarAfiFovis.pedGenero = 'MASCULINO' THEN 'M'
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
					 AND perDetJefeHogarAfiFovis.pedGenero ='INDEFINIDO' THEN 'I'
				ELSE NULL
			END AS codigoGeneroAfiliado2, -- VARIABLE 3
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perDetJefeHogarAfiFovis.pedFechaNacimiento 
				ELSE NULL
			END AS fechaNacimientoAfiliado2, -- VARIABLE 4
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN SUBSTRING(perJefeHogarAfiFovis.perPrimerApellido,0,60) 
				ELSE NULL
			END AS primerApellidoAfiliado2, -- VARIABLE 5
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN perJefeHogarAfiFovis.perSegundoApellido 
				ELSE NULL
			END AS segundoApellidoAfiliado2, -- VARIABLE 6
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perJefeHogarAfiFovis.perPrimerNombre 
				ELSE NULL
			END AS primerNombreAfiliado2, -- VARIABLE 7
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN perJefeHogarAfiFovis.perSegundoNombre 
				ELSE NULL
			END AS segundoNombreAfiliado2, -- VARIABLE 8
			CASE 
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR')--codigo noveddad c01
				THEN depAfiFovis.depCodigo
				ELSE NULL
			END AS departamentoAfiliado, -- VARIABLE 9
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_FECHA_NACIMIENTO_PERSONA_DEPWEB','CAMBIO_FECHA_NACIMIENTO_PERSONA_PRESENCIAL','CAMBIO_FECHA_NACIMIENTO_PERSONA_WEB','CAMBIO_GENERO_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB','CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_PRESENCIAL','CAMBIO_DATOS_CORRESPONDENCIA_GRUPO_FAMILIAR_WEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_DEPWEB','CAMBIO_DATOS_CORRESPONDENCIA_PERSONAS_WEB','ACTUALIZACION_DATOS_CONTACTO_JEFE_HOGAR') --codigo noveddad c01
				THEN munAfiFovis.munCodigo 
				ELSE NULL
			END AS municipioAfiliado, -- VARIABLE 10
			--========= FIN NOVEDAD C01 ================
			--====== INICIA NOVEDAD C03 Y C07 ============
			CASE
				WHEN tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL
				THEN rolAfiFovis.roaFechaIngreso
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --CODIGO NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO') THEN empleadorAportanteFovis.empFechaCambioEstadoAfiliacion
			    WHEN  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION', -- CODIGO C03
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO') THEN rolAfiFovis.roaFechaIngreso 
				ELSE NULL
			END AS fechaAfiliacion, -- VARIABLE 11
			NULL AS VARABLE12,
			--====== FIN NOVEDAD C07 ============
			---===== INICIA NOVEDAD C03 ========
			CASE 
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					  AND rolAfiFovis.roaTipoAfiliado = 'TRABAJADOR_DEPENDIENTE' THEN 1
				WHEN ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					AND	 rolAfiFovis.roaTipoAfiliado = 'TRABAJADOR_INDEPENDIENTE' THEN 2 --2 - Trabajador afiliado facultativo
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')) 
					 AND rolAfiFovis.roaTipoAfiliado = 'PENSIONADO' THEN 3
				ELSE NULL
			END AS codigoTipoAfiliado, -- VARIABLE 13
			---===== INICIA NOVEDAD C04, CONTINUA C03 ========
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')) 
					 AND  perAportanteAfi.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perAportanteAfi.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='TARJETA_IDENTIDAD' THEN 'TI'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='CEDULA_EXTRANJERIA' THEN 'CE'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='PASAPORTE' THEN 'PA'
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE') OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 AND perEmpAportanteAfi.perTipoIdentificacion ='CARNE_DIPLOMATICO' THEN 'CD' 
				ELSE NULL
			END AS tipoIdAportante,  -- VARIABLE 14
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NOT NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perAportanteAfi.perNumeroIdentificacion 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perEmpAportanteAfi.perNumeroIdentificacion 
				ELSE NULL
			END AS numeroIdAportante, -- VARIABLE 15
			CASE 
				WHEN ( (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE', --NOVEDAD C04
					 'RETIRO_TRABAJADOR_INDEPENDIENTE')) OR dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
					 THEN perEmpAportanteAfi.perDigitoVerificacion
				ELSE NULL
			END AS digitoVerificacionAportante, -- VARIABLE 16
			--======== FIN NOVEDAD C04 =========
			--==================================
			CASE 
				WHEN (aporteGenAfiFovis.apgPersona IS NOT NULL AND  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
				THEN CONCAT(perAportanteAfi.perPrimerNombre,' ',perAportanteAfi.perSegundoNombre, ' ', perAportanteAfi.perPrimerApellido, ' ',perAportanteAfi.perSegundoApellido)
				WHEN (aporteGenAfiFovis.apgPersona IS NULL AND dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO'))
				THEN perEmpAportanteAfi.perRazonSocial
				ELSE NULL
			END AS razonSocialAportante, -- VARIABLE 17
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN aporteGenAfiFovis.roaFechaAfiliacion 
				ELSE NULL
			END AS fechaVinculacionAportante, -- VARIABLE 18
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN depEmpAportanteAfi.depCodigo 
				ELSE NULL
			END AS departamentoUbicacion, -- VARIABLE 19
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
				THEN munEmpAportanteAfi.munCodigo 
				ELSE NULL
			END AS municipioUbicacion, -- VARIABLE 20
			NULL AS VARIABLE21,
			NULL AS VARIABLE22,
			--========================= FIN NOVEDAD C03 ==================
			--============================================================
			--ESTADO AFILIACIÓN 21: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--AL DIA (1- AL DIA O 2- EN MORA) 22: NO SE MUESTRA EN NINGUNA DE LAS 'NOVEDADES'
			--- ================= INICIO NOVEDAD 'C07' ================-----
			CASE
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO')
			     	 AND tablaNuevoAfiBen.idBenAAfi IS NOT NULL THEN 1
				WHEN dbo.ParametrizacionNovedad.novTipoTransaccion IN ('AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO', --NOVEDAD C03
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO') 
			     	 AND tablaNuevoAfiBen.idAfiABen IS NOT NULL  THEN 2
				ELSE NULL
			END AS codigoTipoMiembroPoblacionCubierta, -- VARIABLE 23
			---==== FIN ULTIMO CAMPO NOVEDAD C03 ============
			--- === NOVEDADES 'C07' Y 'C08' =================
			CASE
				WHEN tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )  AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN perJefeHogarAfiFovis.perTipoIdentificacion
				WHEN (tablaNuevoAfiBen.idAfiABen IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL)
				THEN perBenFovis.perTipoIdentificacion
				END AS tipoIdMiembroPoblacionCubierta, -- VARIABLE 24
			CASE
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN perJefeHogarAfiFovis.perNumeroIdentificacion
				WHEN (tablaNuevoAfiBen.idAfiABen IS NOT NULL) OR (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL)
				THEN perBenFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdMiembroPoblacionCubierta, -- VARIABLE 25
			--- ==== FIN NOVEDAD 'C08' ========
			CASE 
				WHEN benFovis.benGradoAcademico IS NOT NULL AND benDetFovis.bedCertificadoEscolaridad = 1 THEN 'E' --ESTUDIANTE
				WHEN benFovis.benGradoAcademico IS NULL AND benDetFovis.bedCertificadoEscolaridad = 0 THEN 'D' --DISCAPACITADO
				ELSE NULL
			END AS codigoCondicionBeneficiario, -- VARIABLE 26
			CASE
				WHEN --codigoNovedad = 'C07' 
					(tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario = 'CONYUGE' THEN 1
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('HIJO_BIOLOGICO','HIJO_ADOPTIVO','HIJASTRO','BENEFICIARIO_EN_CUSTODIA') THEN 2
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('PADRE','MADRE') THEN 3
				WHEN (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL) AND benFovis.benTipoBeneficiario IN ('HERMANO_HUERFANO_DE_PADRES','HERMANO_HOGAR') THEN 4
				ELSE NULL
			END AS codigoTipoRelacionConAfiliadoBen, -- VARIABLE 27
			--- ================= FIN NOVEDAD 'C07' =====================-----
			--- ================= INICIO NOVEDAD 'C09' ====================----
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN dbo.SolicitudAsignacion.safFechaAceptacion 
				ELSE NULL
			END AS fechaAsignacionSubsidio, -- VARIABLE 28
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN LEFT(CAST(dbo.SolicitudAsignacion.safValorSFVAsignado AS VARCHAR), CHARINDEX('.', CAST(dbo.SolicitudAsignacion.safValorSFVAsignado AS VARCHAR)) - 1)
				ELSE NULL
			END AS valorSubsidio, -- VALOR 29
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN 4 
				ELSE NULL
			END AS codigoTipoSubsidio, -- VARIABLE 30
			CASE 
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('ASIGNADO_SIN_PRORROGA','ASIGNADO_CON_PRIMERA_PRORROGA',  --codigoNovedad = 'C09' 
					 'ASIGNADO_CON_SEGUNDA_PRORROGA', 'SUBSIDIO_LEGALIZADO') THEN 1
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('VENCIMIENTO_POR_ASIGNACION_SIN_PRORROGA',
					 'VENCIMIENTO_POR_ASIGNACION_SIN_SEGUNDA_PRORROGA', 'PENDIENTE_APROBACION_PRORROGA') THEN 2
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar IN ('SUBSIDIO_CON_ANTICIPO_DESEMBOLSADO','SUBSIDIO_DESEMBOLSADO') THEN 3
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar = 'VENCIMIENTO_POR_ASIGNACION_CON_SEGUNDA_PRORROGA_CADUCADA' THEN 4
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND dbo.PostulacionFOVIS.pofEstadoHogar = 'RECHAZADO' THEN 5 -- TODO: FALTA SABER QUE ANTES ESTUVO ASIGNADO
			    ELSE NULL
			END AS estadoSubsidio, -- VARIABLE 31
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN (SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_DEPTO_ID') 
				ELSE NULL
			END AS departamentoSubsidio, -- VARIABLE 32
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN (SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_MUNI_ID') 
				ELSE NULL
			END AS municipioSubsidio, -- VARIABLE 33
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL--codigoNovedad = 'C09'
				THEN Legalizacion.fechaTransferencia 
				ELSE NULL
			END AS fechaEntregaUltimoSubsidio, -- VARIABLE 34
			--- ================= FIN NOVEDAD 'C09' =====================
			--===================================================
			--================== INICIO NOVEDAD C04 ===========================
			CASE
				WHEN  dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE') --codigoNovedad = 'C04'
				THEN aporteGenAfiFovis.roaFechaRetiro
				ELSE NULL
			END AS fechaDesvinculacionAportante, -- VARIABLE 35
			 ---== NOVEDADES C04 Y C08 ====---
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE')) --codigoNovedad = 'C04' 
					 OR ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS', --codigoNovedad = 'C08'
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )  AND rolAfiFovis.roaFechaRetiro IS NOT NULL)
				THEN rolAfiFovis.roaFechaRetiro
				WHEN ( dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS', --codigoNovedad = 'C08'
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND 
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ) AND  benFovis.benFechaRetiro IS NOT NULL) THEN benFovis.benFechaRetiro
				ELSE NULL
			END AS fechaRetiroAfiliado, -- VARIABLE 36
			CASE
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					  AND perDetJefeHogarAfiFovis.pedFechaFallecido IS NOT NULL)
					 THEN perDetJefeHogarAfiFovis.pedFechaFallecido 
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN('RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_TRABAJADOR_DEPENDIENTE') --codigoNovedad = 'C04'
					  AND  perDetBenFovis.pedFechaFallecido IS NOT NULL) THEN perDetBenFovis.pedFechaFallecido
				ELSE NULL
			END AS fechaFallecimiento, -- VARIABLE 37
			--============= FIN NOVEDAD C04  ===========
			--- ================= INICIO NOVEDAD 'C09' ====================----
			CASE  
				WHEN --codigoNovedad = 'C09'
					 dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'REGISTRO_CIVIL' THEN 'RC'
			    WHEN --codigoNovedad = 'C09' 
			    	 dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'PASAPORTE' THEN 'PA'
			    WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND perBenFovis.perTipoIdentificacion = 'CARNE_DIPLOMATICO' THEN 'CD'
			    ELSE NULL
			END AS tipoIdbeneficiario,-- VARIABLE 38
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL --codigoNovedad = 'C09' 
				THEN perBenFovis.perNumeroIdentificacion
				ELSE NULL
			END AS numeroIdBeneficiario, -- VARIABLE 39
			NULL AS VARIABLE40,
			NULL AS VARIABLE41,
			NULL AS VARIABLE42,
			NULL AS VARIABLE43,
			NULL AS VARIABLE44,
			NULL AS VARIABLE45,
			NULL AS VARIABLE46,
			NULL AS VARIABLE47,
			NULL AS VARIABLE48,
			NULL AS VARIABLE49,
			NULL AS VARIABLE50,
			NULL AS VARIABLE51,
			NULL AS VARIABLE52,
			NULL AS VARIABLE53,
			NULL AS VARIABLE54,
			--- ================= FIN NOVEDAD 'C09' =====================
			/*CASE perDetBenFovis.pedGenero   --TODO: DEL CAMPO 40 AL 54 NO SE USAN
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroBeneficiario,
			perDetBenFovis.pedFechaExpedicionDocumento AS fechaNacimientoBeneficiario,
			perBenFovis.perPrimerApellido AS primerApellidoBeneficiario,
			perBenFovis.perSegundoApellido AS segundoApellidoBeneficiario,
			perBenFovis.perPrimerNombre  AS primerNombreBeneficiario,
			perBenFovis.perSegundoNombre AS segundoNombreBeneficiario,
			CASE perEmpAportanteAfi.perTipoIdentificacion--perEmpresaFovis.perTipoIdentificacion
			    WHEN 'CEDULA_CIUDADANIA' THEN 1
				WHEN 'NIT' THEN 2
			END AS tipoIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perNumeroIdentificacion
			perEmpAportanteAfi.perNumeroIdentificacion AS numeroIdEmpresaRecibeSubsidio,
			--perEmpresaFovis.perDigitoVerificacion 
			perEmpAportanteAfi.perDigitoVerificacion AS digitoVerificacionIdEmpresaSubsidio,
			--perEmpresaFovis.perRazonSocial 
			perEmpAportanteAfi.perRazonSocial AS razonSocialEmpresaSubsidio,
			1 AS aQuienSeOtorgoSubsidio, 
			':fechaInicio' AS fechaInicialPeriodoInformacion,
			':fechaFin' AS fechaFinalPeriodoInformacion,
			0 AS totalRegistroRelacionadosArchivo,
			':nombreReporte' AS nombreDelArchivo,*/ 
			CASE
				WHEN dbo.SolicitudNovedadFovis.snfId IS NOT NULL --codigoNovedad = 'C09' 
				THEN dbo.SolicitudAsignacion.safId 
				ELSE NULL
			END AS identificadorUnicoSubsidio, -- VARIABLE 55
			NULL AS nuevoTipoIdMiembrePoblacionCubierta,  --CAMPO 56
			NULL AS nuevoNumeroIdMiembroPoblacionCubierta, -- CAMPO57
			CASE
				WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ))
					 AND rolAfiFovis.roaFechaRetiro IS NOT NULL AND rolAfiFovis.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR') 
					 THEN 1
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					  AND ((rolAfiFovis.roaFechaRetiro IS NOT NULL AND rolAfiFovis.roaMotivoDesafiliacion = 'FALLECIMIENTO') OR
					 (benFovis.benFechaRetiro IS NOT NULL AND benFovis.benMotivoDesafiliacion = 'FALLECIMIENTO')) THEN 2
				WHEN (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					 AND (rolAfiFovis.roaMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' OR
					 empleadorAportanteFovis.empMotivoDesafiliacion = 'RETIRO_POR_TRASLADO_OTRA_CCF' OR benFovis.benMotivoDesafiliacion = 'RETIRO_POR_CAMBIO_DE_CAJA_COMPENSACION' )
					 THEN 3
			    WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL ))
			    	  AND dbo.ParametrizacionNovedad.novTipoTransaccion = 'SUSTITUCION_PATRONAL') THEN 6
			    WHEN ((dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) AND empleadorAportanteFovis.empMotivoDesafiliacion = 'FUSION_ADQUISICION' 
					  OR  dbo.ParametrizacionNovedad.novTipoTransaccion = 'DESAFILIAR_AUTOMATICAMENTE_EMPLEADORES_SOLICITUD_RECHAZADA'
					  AND rolAfiFovis.roaMotivoDesafiliacion = 'DESAFILIACION_EMPLEADOR') THEN 7
			 	--TODO: FALTAN LAS CAUSAS DE RETIRO DE LA 4 A LA 12
				WHEN ( (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
					 'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
					 'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
					 'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
					 'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND
					 (benFovis.benFechaRetiro IS NOT NULL OR rolAfiFovis.roaFechaRetiro IS NOT NULL )) 
					 AND benFovis.benFechaRetiro IS NOT NULL AND benFovis.benMotivoDesafiliacion = 'OTROS' ) THEN 30 
				ELSE NULL
			END AS causaRetiro, -- VARIABLE 58
			@fechaInicio,
			@fechaFin
			FROM dbo.SolicitudAsignacion
			INNER JOIN dbo.PostulacionFOVIS ON dbo.PostulacionFOVIS.pofSolicitudAsignacion = dbo.SolicitudAsignacion.safId
			INNER JOIN dbo.JefeHogar ON dbo.JefeHogar.jehId = dbo.PostulacionFOVIS.pofJefeHogar
			INNER JOIN dbo.Afiliado AS afiFovis ON afiFovis.afiId =dbo.JefeHogar.jehAfiliado
			INNER JOIN dbo.RolAfiliado AS rolAfiFovis ON rolAfiFovis.roaAfiliado = afiFovis.afiId
			INNER JOIN dbo.Persona AS perJefeHogarAfiFovis ON perJefeHogarAfiFovis.perId = afiFovis.afiPersona
			INNER JOIN dbo.Ubicacion AS ubiAfiFovis ON ubiAfiFovis.ubiId = perJefeHogarAfiFovis.perUbicacionPrincipal
			INNER JOIN dbo.Municipio AS munAfiFovis ON munAfiFovis.munId = ubiAfiFovis.ubiMunicipio
			INNER JOIN dbo.Departamento AS depAfiFovis ON depAfiFovis.depId = munAfiFovis.munDepartamento
			INNER JOIN dbo.PersonaDetalle AS perDetJefeHogarAfiFovis ON perDetJefeHogarAfiFovis.pedPersona = perJefeHogarAfiFovis.perId
			INNER JOIN dbo.AporteDetallado AS aporteDetAfiFovis ON aporteDetAfiFovis.apdPersona = afiFovis.afiPersona
			LEFT JOIN (
						SELECT CASE WHEN afiRol.roaEmpleador IS NOT NULL THEN NULL ELSE afi.afiPersona END apgPersona, 
								empleadorAporte.empEmpresa apgEmpresa,
							   	afiRol.roaFechaAfiliacion,
							   	afiRol.roaFechaRetiro,
							   	afiRol.roaId,
							   	empleadorAporte.empMotivoDesafiliacion,
							   	empleadorAporte.empFechaCambioEstadoAfiliacion
						FROM dbo.RolAfiliado AS afiRol
						LEFT JOIN dbo.Empleador AS empleadorAporte ON empleadorAporte.empId = afiRol.roaEmpleador
						LEFT JOIN dbo.Afiliado afi ON afi.afiId = afiRol.roaAfiliado
			) AS aporteGenAfiFovis ON aporteGenAfiFovis.roaId = rolAfiFovis.roaId
			LEFT JOIN dbo.Persona AS perAportanteAfi ON perAportanteAfi.perId = aporteGenAfiFovis.apgPersona
			LEFT JOIN dbo.Empresa AS empAportanteAfi ON empAportanteAfi.empId = aporteGenAfiFovis.apgEmpresa
			LEFT JOIN dbo.Empleador AS empleadorAportanteFovis ON empAportanteAfi.empId = empleadorAportanteFovis.empEmpresa
			LEFT JOIN dbo.Persona AS perEmpAportanteAfi ON perEmpAportanteAfi.perId = empAportanteAfi.empPersona
			LEFT JOIN dbo.Ubicacion AS ubiEmpAportanteAfi ON ubiEmpAportanteAfi.ubiId = perEmpAportanteAfi.perUbicacionPrincipal
			LEFT JOIN dbo.Municipio AS munEmpAportanteAfi ON munEmpAportanteAfi.munId = ubiEmpAportanteAfi.ubiMunicipio
			LEFT JOIN dbo.Departamento AS depEmpAportanteAfi ON depEmpAportanteAfi.depId = munEmpAportanteAfi.munDepartamento
			INNER JOIN dbo.Beneficiario AS benFovis ON benFovis.benAfiliado = afiFovis.afiId
			INNER JOIN dbo.BeneficiarioDetalle AS benDetFovis ON benDetFovis.bedId = benFovis.benBeneficiarioDetalle
			INNER JOIN dbo.Persona AS perBenFovis ON perBenFovis.perId = benFovis.benPersona
			INNER JOIN dbo.PersonaDetalle AS perDetBenFovis ON perDetBenFovis.pedPersona = perBenFovis.perId
			INNER JOIN dbo.SolicitudLegalizacionDesembolso ON dbo.SolicitudLegalizacionDesembolso.sldPostulacionFOVIS = dbo.PostulacionFOVIS.pofId
			INNER JOIN (SELECT dbo.LegalizacionDesembolso.lgdFechaTransferencia AS fechaTransferencia, dbo.LegalizacionDesembolso.lgdId AS id
					    FROM dbo.LegalizacionDesembolso
					    --WHERE LegalizacionDesembolso.lgdFechaTransferencia BETWEEN :fechaInicio AND :fechaFin
			 			) AS Legalizacion 
			ON Legalizacion.id = dbo.SolicitudLegalizacionDesembolso.sldLegalizacionDesembolso
			LEFT JOIN dbo.ProyectoSolucionVivienda ON dbo.ProyectoSolucionVivienda.psvId = dbo.PostulacionFOVIS.pofProyectoSolucionVivienda
			LEFT JOIN dbo.Oferente ON dbo.Oferente.ofeId = dbo.ProyectoSolucionVivienda.psvOferente AND  (dbo.Oferente.ofeEmpresa = empAportanteAfi.empId) 
			--LEFT JOIN dbo.Empresa ON dbo.Oferente.ofeEmpresa = dbo.Empresa.empId
			--LEFT JOIN dbo.Persona AS perEmpresaFovis ON perEmpresaFovis.perId = dbo.Empresa.empPersona
			INNER JOIN dbo.Solicitud ON dbo.SolicitudAsignacion.safSolicitudGlobal = dbo.Solicitud.solId
			LEFT JOIN dbo.SolicitudNovedad ON dbo.Solicitud.solId = dbo.SolicitudNovedad.snoSolicitudGlobal
			LEFT JOIN #FechasNovedadesSolicituNovedad AS novedadesAprobadas ON novedadesAprobadas.snoId = dbo.SolicitudNovedad.snoId
			LEFT JOIN dbo.ParametrizacionNovedad ON dbo.SolicitudNovedad.snoNovedad = dbo.ParametrizacionNovedad.novId
			LEFT JOIN dbo.NovedadDetalle ON (dbo.SolicitudNovedad.snoId = dbo.NovedadDetalle.nopId AND dbo.NovedadDetalle.nopVigente = 1)
			LEFT JOIN 
			(
				SELECT personaAfiliadoABeneficiario.perId AS idAfiABen, NULL AS idBenAAfi --se obtienen los afiliados que pasaron a ser beneficiarios
				FROM dbo.Afiliado AS afi1
				INNER JOIN dbo.RolAfiliado AS rolAfi1 ON (rolAfi1.roaAfiliado = afi1.afiId
						   AND rolAfi1.roaFechaRetiro IS NOT NULL AND rolAfi1.roaEstadoAfiliado = 'INACTIVO')
				INNER JOIN dbo.Persona AS personaAfiliadoABeneficiario ON afi1.afiPersona = personaAfiliadoABeneficiario.perId
				INNER JOIN dbo.Beneficiario AS ben1 ON (ben1.benPersona = afi1.afiPersona AND ben1.benEstadoBeneficiarioAfiliado = 'ACTIVO'
						   --AND benFovis.benId = ben1.benId
						   )
				UNION
				SELECT NULL AS idAfiABen, personaBeneficiarioAAFiliado.perId AS idBenAAfi -- se obtienen los beneficiarios que pasaron a ser afiliados
				FROM dbo.Beneficiario AS ben1
				INNER JOIN dbo.Persona AS personaBeneficiarioAAFiliado ON ben1.benPersona = personaBeneficiarioAAFiliado.perId
				INNER JOIN dbo.Afiliado AS afi1 ON afi1.afiPersona = ben1.benPersona --AND afi1.afiId = afiFovis.afiId
				INNER JOIN dbo.RolAfiliado AS rolAfi1 ON (rolAfi1.roaAfiliado = afi1.afiId AND rolAfi1.roaEstadoAfiliado = 'ACTIVO')
				WHERE ben1.benEstadoBeneficiarioAfiliado ='INACTIVO' AND ben1.benFechaRetiro IS NOT NULL
			) AS tablaNuevoAfiBen ON (tablaNuevoAfiBen.idBenAAfi = perJefeHogarAfiFovis.perId OR tablaNuevoAfiBen.idAfiABen = perBenFovis.perId)
			LEFT JOIN dbo.SolicitudNovedadFovis ON dbo.Solicitud.solId = dbo.SolicitudNovedadFovis.snfSolicitudGlobal
			LEFT JOIN #FechasNovedadesSolicituNovedadFovis AS novedadesFovisAprobadas ON novedadesFovisAprobadas.snfId = dbo.SolicitudNovedadFovis.snfId
			LEFT JOIN dbo.SolicitudNovedadPersonaFovis ON (dbo.SolicitudNovedadFovis.snfId = dbo.SolicitudNovedadPersonaFovis.spfSolicitudNovedadFovis 
					   AND dbo.PostulacionFOVIS.pofId = dbo.SolicitudNovedadPersonaFovis.spfPostulacionFovis)
			WHERE rolAfiFovis.roaEstadoAfiliado = 'ACTIVO' AND 
			( 
			  (dbo.ParametrizacionNovedad.novTipoTransaccion IN ('CAMBIO_NOMBRE_APELLIDOS_PERSONAS_DEPWEB', 'CAMBIO_NOMBRE_APELLIDOS_PERSONAS',
			   'CAMBIO_NOMBRE_APELLIDOS_PERSONAS_WEB', 'CAMBIO_GENERO_PERSONAS', 'CAMBIO_TIPO_NUMERO_DOCUMENTO_PERSONAS',
			    'AFILIACION_EMPLEADORES_PRESENCIAL_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_PRESENCIAL_REINTEGRO',
					 'AFILIACION_EMPLEADORES_WEB_NUEVA_AFILIACION','AFILIACION_EMPLEADORES_WEB_REINTEGRO','AFILIACION_PERSONAS_PRESENCIAL_NUEVA_AFILIACION',
					 'AFILIACION_PERSONAS_PRESENCIAL_REINTEGRO','AFILIACION_PERSONAS_WEB_DEPENDIENTE_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_DEPENDIENTE_REINTEGRO',
					 'AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_NUEVA_AFILIACION','AFILIACION_PERSONAS_WEB_INDEPENDIENTE_PENSIONADO_REINTEGRO',    
			   'RETIRO_TRABAJADOR_DEPENDIENTE','RETIRO_TRABAJADOR_INDEPENDIENTE','RETIRO_PENSIONADO_25ANIOS',
			   'RETIRO_PENSIONADO_MAYOR_1_5SM_0_6','RETIRO_PENSIONADO_MAYOR_1_5SM_2','RETIRO_PENSIONADO_MENOR_1_5SM_0','RETIRO_PENSIONADO_MENOR_1_5SM_0_6',
			   'RETIRO_PENSIONADO_MENOR_1_5SM_2','RETIRO_PENSIONADO_PENSION_FAMILIAR','RETIRO_CONYUGE','RETIRO_HJO_BIOLOGICO','RETIRO_HIJASTRO','RETIRO_HERMANO_HUERFANO',
			   'RETIRO_HIJO_ADOPTIVO','RETIRO_BENEFICIARIO_CUSTODIA','RETIRO_PADRE','RETIRO_MADRE','RETIRAR_BENEFICIARIO_EDAD_MAYOR_IGUAL_18_NO_TIENE_CEDULA',
			   'RETIRAR_AUTOMATICAMENTE_BENEFICIARIO_X_EDAD','RETIRO_AUTOMATICO_POR_MORA') AND  novedadesAprobadas.fechaRegistroNovedadCerrada BETWEEN @fechaInicio AND @fechaFin)
			   OR (dbo.SolicitudNovedadFovis.snfId IS NOT NULL AND novedadesFovisAprobadas.fechaRegistroNovedadCerrada BETWEEN @fechaInicio AND @fechaFin)
			   OR
			   (
				   (tablaNuevoAfiBen.idBenAAfi IS NOT NULL OR tablaNuevoAfiBen.idAfiABen IS NOT NULL)  AND benFovis.benFechaAfiliacion BETWEEN @fechaInicio AND @fechaFin
			   )
			)
		UNION ALL -- PARTE SUBSIDIOS	
			SELECT @fechaFin,
			2 AS tipoRegistro,
			(SELECT cnsValor FROM dbo.Constante WHERE cnsNombre = 'CAJA_COMPENSACION_CODIGO') AS codigoCCF,
			CASE perAfiCore.perTipoIdentificacion 
			    WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN 'PASAPORTE' THEN 'PA'
			    WHEN 'CARNE_DIPLOMATICO' THEN 'CD' 
			END AS tipoIdAfiliado,
			perAfiCore.perNumeroIdentificacion AS numeroIdAfiliado,
			CASE perDetAfiCore.pedGenero
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroAfiliado,
			perDetAfiCore.pedFechaNacimiento AS fechaNacimientoAfiliado,
			SUBSTRING(perAfiCore.perPrimerApellido,0,60) AS primerApellidoAfiliado,
			SUBSTRING(perAfiCore.perSegundoApellido,0,60) AS segundoApellidoAfiliado,
			SUBSTRING(perAfiCore.perPrimerNombre,0,60) AS primerNombreAfiliado,
			SUBSTRING(perAfiCore.perSegundoNombre,0,60) AS segundoNombreAfiliado,
			'C09' AS codigoNovedad,
			NULL AS VARIABLE1,
			NULL AS VARIABLE2,
			NULL AS VARIABLE3,
			NULL AS VARIABLE4,
			NULL AS VARIABLE5,
			NULL AS VARIABLE6,
			NULL AS VARIABLE7,
			NULL AS VARIABLE8,
			NULL AS VARIABLE9,
			NULL AS VARIABLE10,
			NULL AS VARIABLE11,
			NULL AS VARIABLE12,
			NULL AS VARIABLE13,
			NULL AS VARIABLE14,
			NULL AS VARIABLE15,
			NULL AS VARIABLE16,
			NULL AS VARIABLE17,
			NULL AS VARIABLE18,
			NULL AS VARIABLE19,
			NULL AS VARIABLE20,
			NULL AS VARIABLE21,
			NULL AS VARIABLE22,
			NULL AS VARIABLE23,
			NULL AS VARIABLE24,
			NULL AS VARIABLE25,
			NULL AS VARIABLE26,
			NULL AS VARIABLE27,
			sls.slsFechaInicio AS fechaAsignacionSubsidio, -- VARIABLE 28
			LEFT(CAST(detalle.dsaValorSubsidioMonetario  AS VARCHAR), CHARINDEX('.', CAST(detalle.dsaValorSubsidioMonetario  AS VARCHAR)) - 1)
			AS valorSubsidio, -- VARIABLE 29
			1 AS codigoTipoSubsidio, -- VARIABLE 30
			CASE WHEN cuenta.casEstadoTransaccionSubsidio IN ('GENERADO','ENVIADO','APLICADO') THEN 1
				WHEN cuenta.casEstadoTransaccionSubsidio = 'RETENIDO' THEN 2
				WHEN cuenta.casEstadoTransaccionSubsidio = 'COBRADO' THEN 3
				WHEN cuenta.casEstadoTransaccionSubsidio = 'ANULADO' THEN 5
			END AS estadoSubsidio, -- VARIABLE 31 				--codigoNovedad = 'C09'
			(SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_DEPTO_ID') AS departamentoSubsidio, -- VARIABLE 32
			(SELECT prmValor FROM dbo.Parametro WHERE prmNombre = 'CAJA_COMPENSACION_MUNI_ID') AS municipioSubsidio,   -- VARIABLE 33
			NULL AS fechaEntregaUltimoSubsidio, -- VARIABLE 34
			--- ================= FIN NOVEDAD 'C09' =====================
			--===================================================
			--================== INICIO NOVEDAD C04 ===========================
			NULL fechaDesvinculacionAportante, -- VARIABLE 35
			NULL fechaRetiroAfiliado, -- VARIABLE 36
			NULL fechaFallecimiento, -- VARIABLE 37
			--============= FIN NOVEDAD C04  ===========
			--- ================= INICIO NOVEDAD 'C09' ====================----
			CASE perBenCore.perTipoIdentificacion
				WHEN 'REGISTRO_CIVIL' THEN 'RC'
				WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
				WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
				WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
				WHEN 'PASAPORTE' THEN 'PA'
				WHEN 'CARNE_DIPLOMATICO' THEN 'CD'
			END AS tipoIdbeneficiario, -- VARIABLE 38
			perBenCore.perNumeroIdentificacion AS numeroIdBeneficiario, -- VARIABLE 39
			NULL AS VARIABLE40,
			NULL AS VARIABLE41,
			NULL AS VARIABLE42,
			NULL AS VARIABLE43,
			NULL AS VARIABLE44,
			NULL AS VARIABLE45,
			NULL AS VARIABLE46,
			NULL AS VARIABLE47,
			NULL AS VARIABLE48,
			NULL AS VARIABLE49,
			NULL AS VARIABLE50,
			NULL AS VARIABLE51,
			NULL AS VARIABLE52,
			NULL AS VARIABLE53,
			NULL AS VARIABLE54,
			detalle.dsaId AS identificadorUnicoSubsidio, -- VARIABLE 55
			NULL AS nuevoTipoIdMiembrePoblacionCubierta,  --VARIABLE 56
			NULL AS nuevoNumeroIdMiembroPoblacionCubierta, -- VARIABLE 57
			NULL AS causaRetiro,
			@fechaInicio,
			@fechaFin
			FROM dbo.Afiliado AS afiCore
			INNER JOIN dbo.RolAfiliado AS rolAfiCore ON rolAfiCore.roaAfiliado = afiCore.afiId
			INNER JOIN dbo.Persona AS perAfiCore ON afiCore.afiPersona = perAfiCore.perId
			INNER JOIN dbo.PersonaDetalle AS perDetAfiCore ON perAfiCore.perId = perDetAfiCore.pedPersona
			-- Novedades Persona
			LEFT JOIN dbo.DetalleSubsidioAsignado AS detalle ON detalle.dsaAfiliadoPrincipal = afiCore.afiId
			LEFT JOIN dbo.CuentaAdministradorSubsidio AS cuenta ON detalle.dsaCuentaAdministradorSubsidio = cuenta.casId
			LEFT JOIN dbo.SolicitudLiquidacionSubsidio AS sls ON sls.slsId = detalle.dsaSolicitudLiquidacionSubsidio
			LEFT JOIN dbo.Solicitud AS solSubsidio ON sls.slsSolicitudGlobal = solSubsidio.solId
			-- Fechas de las novedades subsidio
			LEFT JOIN dbo.SolicitudNovedad AS sno ON solSubsidio.solId = sno.snoSolicitudGlobal
			LEFT JOIN dbo.ParametrizacionNovedad ON sno.snoNovedad = dbo.ParametrizacionNovedad.novId
			LEFT JOIN #FechasNovedadesSolicituNovedad AS novedadesAprobadas ON novedadesAprobadas.snoId = sno.snoId
			LEFT JOIN (
						SELECT CASE WHEN afiRol.roaEmpleador IS NOT NULL THEN NULL ELSE afi.afiPersona END apgPersona, 
								empleadorAporte.empEmpresa apgEmpresa,
							   	afiRol.roaFechaAfiliacion,
							   	afiRol.roaFechaRetiro,
							   	afiRol.roaId,
							   	empleadorAporte.empMotivoDesafiliacion,
							   	empleadorAporte.empFechaCambioEstadoAfiliacion
						FROM dbo.RolAfiliado AS afiRol
						LEFT JOIN dbo.Empleador AS empleadorAporte ON empleadorAporte.empId = afiRol.roaEmpleador
						LEFT JOIN dbo.Afiliado afi ON afi.afiId = afiRol.roaAfiliado
			) AS aporteGenAfiCore ON aporteGenAfiCore.roaId = rolAfiCore.roaId
			INNER JOIN dbo.BeneficiarioDetalle AS benDetCore ON benDetCore.bedId = detalle.dsaBeneficiarioDetalle
			INNER JOIN dbo.Beneficiario AS benCore ON afiCore.afiId = benCore.benAfiliado AND benDetCore.bedId = benCore.benBeneficiarioDetalle
			INNER JOIN dbo.Persona AS perBenCore ON perBenCore.perId = benCore.benPersona
			WHERE (sls.slsTipoLiquidacion IN ('AJUSTE_DE_CUOTA') OR sls.slsTipoLiquidacionEspecifica IN ('RECONOCER_DISCAPACIDAD', 'RECONOCER_CUOTA_AGRARIA', 'VALOR_CUOTA', 'COMPLEMENTAR_CUOTA'))
  			  AND detalle.dsaFechaHoraCreacion BETWEEN @fechaInicio AND DATEADD(DAY,1,@fechaFin)
  			  AND detalle.dsaOrigenRegistroSubsidio IN('LIQUIDACION_SUBSIDIO_MONETARIO')
  		UNION ALL -- PARTE NOVEDAD C10
  		SELECT @fechaFin,
  				2 AS tipoRegistro,
			(SELECT cnsValor FROM dbo.Constante WHERE cnsNombre = 'CAJA_COMPENSACION_CODIGO') AS codigoCCF,
			CASE perAfiCore.perTipoIdentificacion 
			    WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
			    WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
			    WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
			    WHEN 'PASAPORTE' THEN 'PA'
			    WHEN 'CARNE_DIPLOMATICO' THEN 'CD' 
			END AS tipoIdAfiliado,
			perAfiCore.perNumeroIdentificacion AS numeroIdAfiliado,
			CASE perDetAfiCore.pedGenero
				WHEN 'MASCULINO' THEN 'M'
				ELSE 'F'
			END AS codigoGeneroAfiliado,
			perDetAfiCore.pedFechaNacimiento AS fechaNacimientoAfiliado,
			SUBSTRING(perAfiCore.perPrimerApellido,0,60) AS primerApellidoAfiliado,
			SUBSTRING(perAfiCore.perSegundoApellido,0,60) AS segundoApellidoAfiliado,
			SUBSTRING(perAfiCore.perPrimerNombre,0,60) AS primerNombreAfiliado,
			SUBSTRING(perAfiCore.perSegundoNombre,0,60) AS segundoNombreAfiliado,
			'C10' codigoNovedad,
			NULL , -- VARIABLE 1
			NULL , -- VARIABLE 2
			NULL , -- VARIABLE 3
			NULL , -- VARIABLE 4
			NULL , -- VARIABLE 5
			NULL , -- VARIABLE 6
			NULL , -- VARIABLE 7
			NULL , -- VARIABLE 8
			NULL , -- VARIABLE 9
			NULL , -- VARIABLE 10
			NULL , -- VARIABLE 11
			NULL , -- VARIABLE 12
			NULL , -- VARIABLE 13
			NULL , -- VARIABLE 14
			NULL , -- VARIABLE 15
			NULL , -- VARIABLE 16
			NULL , -- VARIABLE 17
			NULL , -- VARIABLE 18
			NULL , -- VARIABLE 19
			NULL , -- VARIABLE 20
			NULL , -- VARIABLE 21
			NULL , -- VARIABLE 22
			NULL , -- VARIABLE 23
			CASE benModificacionCore.anteriorTipoId
				WHEN 'REGISTRO_CIVIL' THEN 'RC'
				WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
				WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
		        WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
		        WHEN 'PASAPORTE' THEN 'PA'
		        WHEN 'CARNE_DIPLOMATICO' THEN 'CD'
		    end VARIABLE24,
		    benModificacionCore.anteriorNumeroId VARIABLE25	,
			NULL , -- VARIABLE 26
			NULL , -- VARIABLE 27
			NULL , -- VARIABLE 28
			NULL , -- VARIABLE 29
			NULL , -- VARIABLE 30
			NULL , -- VARIABLE 31
			NULL , -- VARIABLE 32
			NULL , -- VARIABLE 33
			NULL , -- VARIABLE 34
			NULL , -- VARIABLE 35
			NULL , -- VARIABLE 36
			NULL , -- VARIABLE 37
			NULL , -- VARIABLE 38
			NULL , -- VARIABLE 39
			NULL , -- VARIABLE 40
			NULL , -- VARIABLE 41
			NULL , -- VARIABLE 42
			NULL , -- VARIABLE 43
			NULL , -- VARIABLE 44
			NULL , -- VARIABLE 45
			NULL , -- VARIABLE 46
			NULL , -- VARIABLE 47
			NULL , -- VARIABLE 48
			NULL , -- VARIABLE 49
			NULL , -- VARIABLE 50
			NULL , -- VARIABLE 51
			NULL , -- VARIABLE 52
			NULL , -- VARIABLE 53
			NULL , -- VARIABLE 54
			NULL , -- VARIABLE 55
			CASE benModificacionCore.actualTipoId
				WHEN 'REGISTRO_CIVIL' THEN 'RC'
				WHEN 'TARJETA_IDENTIDAD' THEN 'TI'
				WHEN 'CEDULA_CIUDADANIA' THEN 'CC'
		        WHEN 'CEDULA_EXTRANJERIA' THEN 'CE'
		        WHEN 'PASAPORTE' THEN 'PA'
		        WHEN 'CARNE_DIPLOMATICO' THEN 'CD'
		    end VARIABLE56,
			benModificacionCore.actualNumeroId VARIABLE57, -- VARIABLE 57
			NULL, -- VARIABLE 58
			@fechaInicio,
			@fechaFin
			FROM dbo.Afiliado AS afiCore
			INNER JOIN dbo.RolAfiliado AS rolAfiCore ON rolAfiCore.roaAfiliado = afiCore.afiId
			INNER JOIN dbo.Persona AS perAfiCore ON afiCore.afiPersona = perAfiCore.perId
			INNER JOIN dbo.PersonaDetalle AS perDetAfiCore ON perAfiCore.perId = perDetAfiCore.pedPersona
			INNER JOIN dbo.Beneficiario AS benCore ON benCore.benAfiliado = afiCore.afiId
			INNER JOIN dbo.BeneficiarioDetalle AS benDetCore ON benDetCore.bedId = benCore.benBeneficiarioDetalle
			INNER JOIN dbo.Persona AS perBenCore ON perBenCore.perId = benCore.benPersona			
			INNER JOIN #PersonasModificacionDatosBasicos benModificacionCore ON benModificacionCore.perId = perBenCore.perId
		    WHERE rolAfiCore.roaEstadoAfiliado = 'ACTIVO'
	END
END TRY
BEGIN CATCH
	THROW;
END CATCH
;

